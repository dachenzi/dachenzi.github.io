<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>16-文件操作-StringIO-BytesIO &middot; Lee Xin</title>

  
  <link rel="stylesheet" href="https://dachenzi.github.io/css/poole.css">
  <link rel="stylesheet" href="https://dachenzi.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://dachenzi.github.io/css/poole-overrides.css">
  <link rel="stylesheet" href="https://dachenzi.github.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="https://dachenzi.github.io/css/hyde-x.css">
  <link rel="stylesheet" href="https://dachenzi.github.io/css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://dachenzi.github.io/touch-icon-144-precomposed.png">
  <link href="https://dachenzi.github.io/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Your default page description">
  <meta name="keywords" content="your,default,page,keywords">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'Your Google Analytics tracking code', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body class="theme-base-08">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1>Lee Xin</h1>
      <p class="lead">Your favourite quote or soundbite.</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="https://dachenzi.github.io/">Blog</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      
      
      
      
      
      
      
      
      
      </li>
    </ul>

    
    <p><script id='flattr'>
      (function(id){
        var s = document.getElementById(id);
        var f = document.createElement('iframe');
        f.src = '//api.flattr.com/button/view/?uid=&button=compact&url=https:\/\/dachenzi.github.io\/&title=daxin\u0027s blog';
        f.title = 'Flattr';
        f.height = 20;
        f.width = 110;
        f.style.borderWidth = 0;
        s.parentNode.insertBefore(f, s);
      })('flattr');
    </script></p>
    

    <p>Copyright &copy; 2020 <a href="https://dachenzi.github.io/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>

  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">16-文件操作-StringIO-BytesIO</h1>
    <span class="post-date">Jan 1, 0001 &middot; 5 minute read &middot; <a href="https://dachenzi.github.io/blog/1/01/01/16-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C-stringio-bytesio/#disqus_thread">Comments</a>
    </span>
    <p>{% raw %}</p>
<p><!-- raw HTML omitted --><strong>文章目录</strong><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<ul>
<li><a href="#1-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C">1 文件操作</a>
<ul>
<li><a href="#11-open%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D">1.1 open函数介绍</a></li>
<li><a href="#12-%E6%89%93%E5%BC%80%E6%93%8D%E4%BD%9C">1.2 打开操作</a>
<ul>
<li><a href="#121-mode%E6%A8%A1%E5%BC%8F">1.2.1 mode模式</a></li>
<li><a href="#122-%E6%96%87%E4%BB%B6%E6%8C%87%E9%92%88">1.2.2 文件指针</a></li>
<li><a href="#123-%E7%BC%93%E5%86%B2%E5%8C%BA">1.2.3 缓冲区</a></li>
<li><a href="#124-encoding%E7%BC%96%E7%A0%81">1.2.4 encoding编码</a></li>
<li><a href="#125-%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0">1.2.5 其他参数</a></li>
</ul>
</li>
<li><a href="#13-%E8%AF%BB%E5%86%99%E6%93%8D%E4%BD%9C">1.3 读写操作</a></li>
<li><a href="#14-%E5%85%B3%E9%97%AD%E6%93%8D%E4%BD%9C">1.4 关闭操作</a></li>
<li><a href="#15-%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86">1.5 上下文管理</a></li>
<li><a href="#16-%E6%96%87%E4%BB%B6%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95">1.6 文件对象的其他方法</a></li>
</ul>
</li>
<li><a href="#2-stringio%E6%A8%A1%E5%9D%97">2 StringIO模块</a></li>
<li><a href="#3-bytesio%E6%A8%A1%E5%9D%97">3 BytesIO模块</a></li>
<li><a href="#4-file-like%E5%AF%B9%E8%B1%A1">4 file-like对象</a></li>
</ul>
<!-- raw HTML omitted -->
<h1 id="1-文件操作">1 文件操作</h1>
<p>        读写文件是最常见的IO操作(一般说IO操作，指的是文件IO，如果是网络，一般都会直接说网络IO)，在磁盘上读写文件的功能都是由操作系统提供的，操作系统不允许普通的程序直接操作磁盘(大部分程序都需要间接的通过操作系统来完成对硬件的操作)，所以，读写文件就是请求操作系统打开一个文件对象（通常称为文件描述符），然后，通过操作系统提供的接口从这个文件对象中读取数据（读文件），或者把数据写入这个文件对象（写文件）。在操作系统中，文件常用的操作有：</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>介绍</th>
</tr>
</thead>
<tbody>
<tr>
<td>open</td>
<td>打开</td>
</tr>
<tr>
<td>read</td>
<td>读取</td>
</tr>
<tr>
<td>write</td>
<td>写</td>
</tr>
<tr>
<td>close</td>
<td>关闭</td>
</tr>
<tr>
<td>readline</td>
<td>行读取</td>
</tr>
<tr>
<td>readlines</td>
<td>多行读取</td>
</tr>
<tr>
<td>seek</td>
<td>文件指针操作</td>
</tr>
<tr>
<td>tell</td>
<td>指针操作</td>
</tr>
</tbody>
</table>
<h2 id="11-open函数介绍">1.1 open函数介绍</h2>
<p>        在python中，我们使用open函数来打开一个文件，然后返回一个文件对象(流对象)和文件描述符。打开文件失败，则返回异常。</p>
<blockquote>
<p>第三方模块codecs包中提供的open函数，具备内置函数open的所有功能，并且在内部它对目标文件进行了编码的与判断处理，当你不知道目标文件的编码类型时，使用codecs.open来说更可靠。</p>
</blockquote>
<h2 id="12-打开操作">1.2 打开操作</h2>
<p>想要读取文件，那么就需要先行打开文件。下面来看一下open函数的用法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">open([<span style="color:#e6db74">&#39;file&#39;</span>, <span style="color:#e6db74">&#34;mode=&#39;r&#39;&#34;</span>, <span style="color:#e6db74">&#39;buffering=-1&#39;</span>, <span style="color:#e6db74">&#39;encoding=None&#39;</span>, <span style="color:#e6db74">&#39;errors=None&#39;</span>, <span style="color:#e6db74">&#39;newline=None&#39;</span>, <span style="color:#e6db74">&#39;closefd=True&#39;</span>, <span style="color:#e6db74">&#39;opener=None&#39;</span>],)
</code></pre></div><ul>
<li><code>file</code>：要打开的文件名(默认为当前路径，否则要指定绝对路径)。</li>
<li><code>mode</code>：表示打开文件的格式。</li>
<li><code>buffering</code>: 设置缓冲区的大小(二进制模式和文本模式不同)</li>
<li><code>encoding</code>：打开文件的编码格式(文本模式)</li>
<li><code>errors</code>: 转码错误时是否提示异常</li>
<li><code>newline</code>: 文本模式中对新行的处理方式</li>
<li><code>closefd</code>: 删除描述符时，文件对象是否释放</li>
</ul>
<blockquote>
<p>Python 2.x中包含file和open两个操作文件的函数，Python 3.x 中只有open，操作方法相同 <code>f = file('/etc/passwd','r') </code></p>
</blockquote>
<h3 id="121-mode模式">1.2.1 mode模式</h3>
<p>文件打开的方式有如下几种：</p>
<table>
<thead>
<tr>
<th>描述字符</th>
<th>意义</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>只读打开</td>
<td>文件的默认打开方式，文件不存在会报异常</td>
</tr>
<tr>
<td>w</td>
<td>只写打开</td>
<td>文件不存在会创建，存在的话，会覆盖源文件（非追加）</td>
</tr>
<tr>
<td>x</td>
<td>创建并只写一个新文件</td>
<td>文件已存在则报错</td>
</tr>
<tr>
<td>a</td>
<td>只追加写模式</td>
<td>在文件末尾追加，文件不存在，新建并追加</td>
</tr>
<tr>
<td>b</td>
<td>二进制模式</td>
<td><code>字节流</code>，将文件就按照字节理解，与字符编码无关。二进制模式操作时，字节操作使用bytes类型</td>
</tr>
<tr>
<td>t</td>
<td>文本模式</td>
<td><code>字符流</code>，将文件的字节按照某种字符编码理解，按照字符操作，缺省模式</td>
</tr>
<tr>
<td>+</td>
<td>读写打开一个文件</td>
<td>给原来只读、只写方式打开提供缺失的读或者写能力</td>
</tr>
</tbody>
</table>
<blockquote>
<p>默认使用文本只读模式打开,特殊文件需要用文本模式传输的话，建议使用b　</p>
</blockquote>
<p>        <code>+符</code>，为r、w、a、x提供缺失的读或者写的功能，但是，获取文件对象依旧按照r、w、a、x自己的特征。但+不能单独使用，可以认为它是为前面的模式字符做的增强功能。</p>
<table>
<thead>
<tr>
<th>描述字符</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>r+</td>
<td>读模式附加写功能</td>
</tr>
<tr>
<td>w+</td>
<td>写模式附加读功能</td>
</tr>
<tr>
<td>a+</td>
<td>追加写模式附加读功能</td>
</tr>
<tr>
<td>x+</td>
<td>打开一个新文件可读可写</td>
</tr>
</tbody>
</table>
<blockquote>
<p>以上为文本模式，二进制模式时只需要添加b即可.即r+b,或者rb+都可</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">In [<span style="color:#ae81ff">2</span>]: f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;hello.txt&#39;</span>,<span style="color:#e6db74">&#39;r&#39;</span>)
<span style="color:#f92672">---------------------------------------------------------------------------</span>
FileNotFoundError                         Traceback (most recent call last)
<span style="color:#f92672">&lt;</span>ipython<span style="color:#f92672">-</span>input<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">-</span><span style="color:#ae81ff">27</span>a5c78b3969<span style="color:#f92672">&gt;</span> <span style="color:#f92672">in</span> <span style="color:#f92672">&lt;</span>module<span style="color:#f92672">&gt;</span>
<span style="color:#f92672">----&gt;</span> <span style="color:#ae81ff">1</span> f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;hello.txt&#39;</span>,<span style="color:#e6db74">&#39;r&#39;</span>)

FileNotFoundError: [Errno <span style="color:#ae81ff">2</span>] No such file <span style="color:#f92672">or</span> directory: <span style="color:#e6db74">&#39;hello.txt&#39;</span>

In [<span style="color:#ae81ff">3</span>]: f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;123.txt&#39;</span>)

In [<span style="color:#ae81ff">4</span>]: f<span style="color:#f92672">.</span>read()
Out[<span style="color:#ae81ff">4</span>]: <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span style="color:#e6db74">abc&#39;</span>

In [<span style="color:#ae81ff">5</span>]: f<span style="color:#f92672">.</span>close()

In [<span style="color:#ae81ff">6</span>]: f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;123.txt&#39;</span>,<span style="color:#e6db74">&#39;w&#39;</span>)

In [<span style="color:#ae81ff">7</span>]: f<span style="color:#f92672">.</span>read()
<span style="color:#f92672">---------------------------------------------------------------------------</span>
UnsupportedOperation                      Traceback (most recent call last)
<span style="color:#f92672">&lt;</span>ipython<span style="color:#f92672">-</span>input<span style="color:#f92672">-</span><span style="color:#ae81ff">7</span><span style="color:#f92672">-</span><span style="color:#ae81ff">571e9</span>fb02258<span style="color:#f92672">&gt;</span> <span style="color:#f92672">in</span> <span style="color:#f92672">&lt;</span>module<span style="color:#f92672">&gt;</span>
<span style="color:#f92672">----&gt;</span> <span style="color:#ae81ff">1</span> f<span style="color:#f92672">.</span>read()

UnsupportedOperation: <span style="color:#f92672">not</span> readable

In [<span style="color:#ae81ff">8</span>]:
</code></pre></div><p>注意：</p>
<ul>
<li>我们把这个 f 成为文件句柄（用来标识一个文件的内存对象），包含文件名，字符集，大小，硬盘上的起始位置等等。</li>
<li>f 在这里就变成了一个文件迭代器，我们可以通过使用for line in f ,去循环的读取文件的每一行内容</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># for 循环遍历文件，打印文件的每一行</span>

In [<span style="color:#ae81ff">11</span>]: f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;123.txt&#39;</span>)

In [<span style="color:#ae81ff">12</span>]: <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> f:
    <span style="color:#f92672">...</span>:     <span style="color:#66d9ef">print</span>(i,end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
    <span style="color:#f92672">...</span>:
hello
world
my
name
<span style="color:#f92672">is</span>
daxin
thanks
In [<span style="color:#ae81ff">13</span>]:
</code></pre></div><blockquote>
<p>注意：这里for line in fd，其实可以从fd.readlines()中读取，但是如果文件很大，那么就会一次性读取到内存中，非常占内存，而这里fd存储的是对象，只有我们读取一行，它才会把这行读取到内存中，建议使用这种方法。</p>
</blockquote>
<h3 id="122-文件指针">1.2.2 文件指针</h3>
<p>        为什么文件只能读一次，第二次读就是空的了？是否可以重复读取呢？在对文件操作中，会存在一个指针<code>用于指定当前光标的位置</code>，当我们读完一次后， 文件指针就指向了文件的末尾了，那么如果想要重复读取，那么只需要对指针的位置进行调整即可。</p>
<ol>
<li>mode = r , 指针起始在0</li>
<li>mode = a , 指针其实在EOF(end of file：文件末尾)</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">f<span style="color:#f92672">.</span>tell()    <span style="color:#75715e"># 显示当前文件指针的位置</span>
f<span style="color:#f92672">.</span>seek(offset, whence<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, <span style="color:#f92672">/</span>)   <span style="color:#75715e"># 移动文件指针的位置</span>
</code></pre></div><ul>
<li>offset：偏移多少字节</li>
<li>whence：从哪里开始</li>
</ul>
<p>在文本模式下：</p>
<ul>
<li>whence <code>0</code>：缺省值，表示从头开始，offset只能正整数</li>
<li>whence <code>1</code>：表示从当前位置开始，offset只能设置为0</li>
<li>whence <code>2</code>：表示从EOF位置开始，offset只能设置为0</li>
</ul>
<blockquote>
<p>文本模式支持从开头向后偏移的方式。whence为1时，只支持偏移0(<code>seek(0,0)</code>)，相当于原地不同，没什么卵用。whence为2时，表示从EOF开始，但也只支持偏移0(<code>seek(0,2)</code>)，相当于将文件指针移动到EOF。</p>
</blockquote>
<p>二进制模式下：</p>
<ul>
<li>whence <code>0</code>: 缺省值，表示从头开始，offset只能正整数</li>
<li>whence <code>1</code>: 表示从当前位置，offset可正可负</li>
<li>whence <code>2</code>: 表示从EOF开始，offset可正可负</li>
</ul>
<blockquote>
<p>二进制模式支持任意起点的偏移，从头、从尾部、从中间位置开始，向后seek可以超界，但是向前seek的时候，不能超界，否则抛异常</p>
</blockquote>
<h3 id="123-缓冲区">1.2.3 缓冲区</h3>
<p>        open函数的第三个参数为buffering，叫作缓冲区，缓冲区是内存中的一小部分空间，用于存放准备写入磁盘的数据，操作系统在进行磁盘写入的时候，由于磁盘速度要远远慢于CPU以及内存，如果每次写入数据时，都要直接写到磁盘上的话，那么效率会非常的低，所以在操作系统层面会对写入操作进行优化，比如缓冲区默认大小为4K或者4K的倍数(为什么是4K，和磁盘扇区有关，这里就不详述了)，当写入的数据小于4K，会先存在缓冲区，当缓冲区满了，或者超过一定时间没有写入，操作系统会将数据一次性的刷入(flush)磁盘。<br>
        buffering的默认值为-1，表示使用缺省大小的buffer，如果是二进制模式，由<code>io.DEFAULT_BUFFER_SIZE</code>决定，默认是<code>4096</code>或者<code>8192</code>，如果是文本模式，设备类型为终端设备时，使用<code>行缓存方式</code>，如果不是，则使用二进制模式的策略。使用其他值时，有如下含义：</p>
<ul>
<li><code>0</code> ：只在二进制模式使用，表示关闭buffer</li>
<li><code>1</code> ：只在文本模式使用，表示使用行缓冲。(见到换行符就flush)</li>
<li><code>大于1</code> ：用于指定buffer的大小</li>
</ul>
<p>二进制场景：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">In [<span style="color:#ae81ff">3</span>]: <span style="color:#f92672">import</span> io

In [<span style="color:#ae81ff">4</span>]: f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;123.txt&#39;</span>,<span style="color:#e6db74">&#39;w+b&#39;</span>)
In [<span style="color:#ae81ff">5</span>]: <span style="color:#66d9ef">print</span>(io<span style="color:#f92672">.</span>DEFAULT_BUFFER_SIZE)
<span style="color:#ae81ff">8192</span>

In [<span style="color:#ae81ff">6</span>]: f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;daxin&#34;</span><span style="color:#f92672">.</span>encode())
Out[<span style="color:#ae81ff">6</span>]: <span style="color:#ae81ff">5</span>
In [<span style="color:#ae81ff">7</span>]: f<span style="color:#f92672">.</span>seek(<span style="color:#ae81ff">0</span>)
Out[<span style="color:#ae81ff">7</span>]: <span style="color:#ae81ff">0</span>
In [<span style="color:#ae81ff">8</span>]: f<span style="color:#f92672">.</span>read()
Out[<span style="color:#ae81ff">8</span>]: <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;daxin&#39;</span>

In [<span style="color:#ae81ff">9</span>]: f<span style="color:#f92672">.</span>flush()    <span style="color:#75715e"># 默认情况下缓冲区大小为8192字节，所以我们写入的不会被立即刷入到磁盘上，如果我们要手动刷入可以手动执行flush命令</span>
In [<span style="color:#ae81ff">10</span>]: f<span style="color:#f92672">.</span>close()   <span style="color:#75715e"># close会触发flush操作</span>

In [<span style="color:#ae81ff">11</span>]: f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;123.txt&#39;</span>,<span style="color:#e6db74">&#39;w+b&#39;</span>,<span style="color:#ae81ff">4</span>)  <span style="color:#75715e"># 缓冲区为4个字节</span>
In [<span style="color:#ae81ff">12</span>]: f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;dax&#39;</span><span style="color:#f92672">.</span>encode())    <span style="color:#75715e"># 3个字节不会刷入磁盘</span>
Out[<span style="color:#ae81ff">12</span>]: <span style="color:#ae81ff">3</span>
In [<span style="color:#ae81ff">13</span>]: f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;in&#39;</span><span style="color:#f92672">.</span>encode())   <span style="color:#75715e"># 超过缓冲区大小会直接连同本次写入的数据一起刷入磁盘</span>
Out[<span style="color:#ae81ff">13</span>]: <span style="color:#ae81ff">2</span>

In [<span style="color:#ae81ff">14</span>]: f<span style="color:#f92672">.</span>seek(<span style="color:#ae81ff">0</span>)
Out[<span style="color:#ae81ff">14</span>]: <span style="color:#ae81ff">0</span>
In [<span style="color:#ae81ff">15</span>]: f<span style="color:#f92672">.</span>read()
Out[<span style="color:#ae81ff">15</span>]: <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;daxin&#39;</span>

In [<span style="color:#ae81ff">16</span>]: f<span style="color:#f92672">.</span>flush()
In [<span style="color:#ae81ff">17</span>]: f<span style="color:#f92672">.</span>close()
</code></pre></div><p>文本字符串场景：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">In [<span style="color:#ae81ff">18</span>]: f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;123.txt&#39;</span>,<span style="color:#e6db74">&#39;w+&#39;</span>)   <span style="color:#75715e"># 没有指定缓冲区的大小，采用默认值-1（由于不是终端设备，所以采用二进制的策略 由io.DEFAULT_BUFFER_SIZE控制</span>
In [<span style="color:#ae81ff">19</span>]: <span style="color:#960050;background-color:#1e0010">!</span>cat <span style="color:#ae81ff">123.</span>txt

In [<span style="color:#ae81ff">20</span>]: f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;daxin&#39;</span>)
Out[<span style="color:#ae81ff">20</span>]: <span style="color:#ae81ff">5</span>

In [<span style="color:#ae81ff">21</span>]: <span style="color:#960050;background-color:#1e0010">!</span>cat <span style="color:#ae81ff">123.</span>txt
In [<span style="color:#ae81ff">22</span>]: f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)   <span style="color:#75715e"># 遇到换行符的时候并没有刷入磁盘</span>
Out[<span style="color:#ae81ff">22</span>]: <span style="color:#ae81ff">1</span>
In [<span style="color:#ae81ff">23</span>]: <span style="color:#960050;background-color:#1e0010">!</span>cat <span style="color:#ae81ff">123.</span>txt    

In [<span style="color:#ae81ff">29</span>]: f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;123.txt&#39;</span>,<span style="color:#e6db74">&#39;w+&#39;</span>,<span style="color:#ae81ff">1</span>)   <span style="color:#75715e"># 指定缓冲区的大小为1(行)</span>
In [<span style="color:#ae81ff">30</span>]: f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;daxin&#39;</span>)
Out[<span style="color:#ae81ff">30</span>]: <span style="color:#ae81ff">5</span>

In [<span style="color:#ae81ff">31</span>]: f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39; hello&#39;</span>)
Out[<span style="color:#ae81ff">31</span>]: <span style="color:#ae81ff">6</span>

In [<span style="color:#ae81ff">33</span>]: <span style="color:#960050;background-color:#1e0010">!</span>cat <span style="color:#ae81ff">123.</span>txt    <span style="color:#75715e"># 没有遇到换行符，所以不会刷入磁盘</span>
In [<span style="color:#ae81ff">34</span>]: f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)   <span style="color:#75715e"># 遇到换行符，然后刷入磁盘</span>
Out[<span style="color:#ae81ff">34</span>]: <span style="color:#ae81ff">1</span>
In [<span style="color:#ae81ff">35</span>]: <span style="color:#960050;background-color:#1e0010">!</span>cat <span style="color:#ae81ff">123.</span>txt
daxin hello

In [<span style="color:#ae81ff">36</span>]:
</code></pre></div><table>
<thead>
<tr>
<th>buffering</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>buffering=1</td>
<td>文本和二进制模式时，都是io.DEFAULT_BUFFER_SIZE控制</td>
</tr>
<tr>
<td>buffering=0</td>
<td>文本模式时不支持，二进制模式时表示关闭缓冲区</td>
</tr>
<tr>
<td>buffering=1</td>
<td>文本模式表示行换成，二进制模式表示一个字节</td>
</tr>
<tr>
<td>buffering&gt;1</td>
<td>文本模式时，是io.DEFAULT_BUFFER_SIZE字节，flush后把当前字符串也写入磁盘。二进制模式时，表示缓冲区的大小，直到超过这个值时，才会刷入磁盘</td>
</tr>
</tbody>
</table>
<blockquote>
<p>一般来说，文本模式一般都用默认缓冲区大小，二进制模式可以指定buffer的大小。除非我们明确知道，否则选择默认缓冲区大小是一个比较好的选择，另外在日常编程中，明确知道需要写磁盘了，都会手动调用一次flush，而不是等到自动flush或者close的时候。</p>
</blockquote>
<h3 id="124-encoding编码">1.2.4 encoding编码</h3>
<p>        当我们操作二进制文件的时候，数据都是十六进制的，并没有什么编码的一说。而在使用文本模式时，就需要指定编码类型了，常用的中文编码比如，GBK、UTF-8、Unicode等，文件在内存中都是Unicode格式的，而存储在磁盘上就是按照本地编码的格式存储了，windows上默认的是GBK(ANSI,cp936)，当我们存储的文本数据不是默认的格式时，在打开时就会产生乱码，这时可以使用指定编码格式打开文件。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">encoding<span style="color:#f92672">=</span>None,<span style="color:#960050;background-color:#1e0010">默认值时，表示使用操作系统默认编码类型</span>
<span style="color:#f92672">-</span> windows: GBK(<span style="color:#ae81ff">0xB0A1</span>)
<span style="color:#f92672">-</span> Linux: UTF<span style="color:#f92672">-</span><span style="color:#ae81ff">8</span>(<span style="color:#ae81ff">0xE5</span> <span style="color:#ae81ff">95</span> <span style="color:#ae81ff">8</span>A)
</code></pre></div><h3 id="125-其他参数">1.2.5 其他参数</h3>
<p><code>errors</code>: 什么样的编码错误将被捕获。</p>
<ul>
<li>None/strict：有编码错误将抛出ValueError异常</li>
<li>ignore：表示忽略</li>
</ul>
<p><code>newline</code>: 文本模式中，换行的转换。可以为None、''(空串)、'\r'、'\n'、'\r\n'。</p>
<ul>
<li>读时，None表示'\r'、'\n'、'\r\n&rsquo;都被转换为'\n';''(空串)表示不会自动转换通用换行符；其他合法字符表示换行符就是指定字符，就会按照指定字符分行</li>
<li>写时，None表示'\n&rsquo;都会被替换为系统指定缺省分隔符(os.linesep);'\n&rsquo;表示'\n&rsquo;不替换；其他的合法字符表示'\n&rsquo;会被替换为指定的字符</li>
</ul>
<p><code>closefd</code>: 关闭文件描述符.</p>
<ul>
<li>True: 表示关闭它</li>
<li>False: 会在文件关闭后保持这个文件描述符</li>
</ul>
<blockquote>
<p>fileobj.fileno()查看</p>
</blockquote>
<h2 id="13-读写操作">1.3 读写操作</h2>
<p><code>read(size=-1)</code>: 表示读取的多少个字符或字节；负数或者None表示读取到EOF(end of file),中文文本时，表示size个字符。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;123.txt&#39;</span>,<span style="color:#e6db74">&#39;r+&#39;</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> f<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">5</span>)
<span style="color:#e6db74">&#39;daxin&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> f<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">5</span>)
<span style="color:#e6db74">&#39; hell&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> f<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">1</span>)
<span style="color:#e6db74">&#39;o&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> f<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">1</span>)
<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> f<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">1</span>)
<span style="color:#e6db74">&#39;你&#39;</span>
</code></pre></div><p><code>readline(size=-1)</code>: 一行行读取文件内容。size设置一次能读取行内几个字符或者字节。负数或者None表示读取到EOF(end of file)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;123.txt&#39;</span>,<span style="color:#e6db74">&#39;r+&#39;</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> f<span style="color:#f92672">.</span>readline(<span style="color:#ae81ff">3</span>)
<span style="color:#e6db74">&#39;a d&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> f<span style="color:#f92672">.</span>readline()  
<span style="color:#e6db74">&#39;axin hello world</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> f<span style="color:#f92672">.</span>readline(<span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>)  
<span style="color:#e6db74">&#39;c</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</code></pre></div><p><code>readlines(hint=-1)</code>: 读取所有行并返回列表。<strong><code>当指定hint为负数时，则会读取所有行，当指定为正数时，表示读取hint个字符所在的行</code></strong>。比如第一行有6个字符，第二行有3个字符，当我们使用readlines(7)时，就会返回两行，而如果使用readlines(5)时就会只返回第一行。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">In [<span style="color:#ae81ff">58</span>]: f<span style="color:#f92672">.</span>readlines()
Out[<span style="color:#ae81ff">58</span>]: [<span style="color:#e6db74">&#39;1</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;2</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;3</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;4</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;5</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;6</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;7</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;8</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;9&#39;</span>]

In [<span style="color:#ae81ff">94</span>]: f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;123.txt&#39;</span>,<span style="color:#e6db74">&#39;r+&#39;</span>)

In [<span style="color:#ae81ff">95</span>]: f<span style="color:#f92672">.</span>readlines(<span style="color:#ae81ff">9</span>)
Out[<span style="color:#ae81ff">95</span>]: [<span style="color:#e6db74">&#39;你好啊我了个去</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;为什么</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>]

In [<span style="color:#ae81ff">98</span>]: f<span style="color:#f92672">.</span>readlines(<span style="color:#ae81ff">3</span>)
Out[<span style="color:#ae81ff">98</span>]: [<span style="color:#e6db74">&#39;你好</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;在&#39;</span>]

In [<span style="color:#ae81ff">99</span>]:
</code></pre></div><p><code>write(s)</code>: 把字符串写入到文件中并返回写入字符串的个数。
<code>writelines(lines)</code>: 将字符串列表写入文件中。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">In [<span style="color:#ae81ff">60</span>]: f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;123.txt&#39;</span>,<span style="color:#e6db74">&#39;r+&#39;</span>)

In [<span style="color:#ae81ff">65</span>]: f<span style="color:#f92672">.</span>seek(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>)
Out[<span style="color:#ae81ff">65</span>]: <span style="color:#ae81ff">25</span>

In [<span style="color:#ae81ff">67</span>]: f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;10&#39;</span>)
Out[<span style="color:#ae81ff">67</span>]: <span style="color:#ae81ff">2</span>

In [<span style="color:#ae81ff">68</span>]: f<span style="color:#f92672">.</span>seek(<span style="color:#ae81ff">25</span>)
Out[<span style="color:#ae81ff">68</span>]: <span style="color:#ae81ff">25</span>

In [<span style="color:#ae81ff">69</span>]: f<span style="color:#f92672">.</span>read()
Out[<span style="color:#ae81ff">69</span>]: <span style="color:#e6db74">&#39;10&#39;</span>

In [<span style="color:#ae81ff">71</span>]: f<span style="color:#f92672">.</span>writelines([<span style="color:#e6db74">&#39;11&#39;</span>,<span style="color:#e6db74">&#39;12&#39;</span>])

In [<span style="color:#ae81ff">72</span>]: f<span style="color:#f92672">.</span>seek(<span style="color:#ae81ff">25</span>)
Out[<span style="color:#ae81ff">72</span>]: <span style="color:#ae81ff">25</span>

In [<span style="color:#ae81ff">73</span>]: f<span style="color:#f92672">.</span>read()
Out[<span style="color:#ae81ff">73</span>]: <span style="color:#e6db74">&#39;101112&#39;</span>
</code></pre></div><h2 id="14-关闭操作">1.4 关闭操作</h2>
<p>        当我们打开一个文件时，那么在系统中就会存在一个文件描述符对应这个文件，并且在文件系统中，一个程序可以使用的文件描述符的数量是有限的，如果我们使用完毕后不进行释放，那么很有可能就耗光文件描述符的数量(Linux中默认的文件描述符为1024，使用ulimit -a查看)，产生异常，所以在使用完毕后，我们就需要手动的进行关闭</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">f<span style="color:#f92672">.</span>close()   
</code></pre></div><blockquote>
<p>关闭文件的操作，会同时调用flush()，把缓冲区的数据刷入磁盘。当文件已经关闭，再次关闭没有任何效果</p>
</blockquote>
<h2 id="15-上下文管理">1.5 上下文管理</h2>
<p>        上面说我们每次打开一个文件都需要手动的进行关闭，那么如果忘记了，这个文件会一直占用着对应的文件描述符，如果多次打开一个文件不关闭，那么每次都会占用新的文件秒师傅，直到文件描述符用完。上下文管理就是为了解决这种问题的，它有如下特点：</p>
<ol>
<li>使用 with .. as 关键字。</li>
<li>with语句块执行完毕的时候，会自动关闭文件对象</li>
<li>不会开启新的作用域(不会产生诸如函数的内部变量等)</li>
</ol>
<p>        2.6以上版本支持with读取,<code>with open('/tmp/hello.txt') as fd:</code>,然后所有打开文件的操作都需要缩进，包含在with下才，这样不需要明确的指定close，当新的代码没有缩进的时候，文件会自动关闭。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">In [<span style="color:#ae81ff">103</span>]: <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;123.txt&#39;</span>,<span style="color:#e6db74">&#39;r+&#39;</span>) <span style="color:#66d9ef">as</span> f:
     <span style="color:#f92672">...</span>:     f<span style="color:#f92672">.</span>read()
     <span style="color:#f92672">...</span>:

In [<span style="color:#ae81ff">105</span>]: f<span style="color:#f92672">.</span>closed
Out[<span style="color:#ae81ff">105</span>]: True
</code></pre></div><p>或者：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PYTHON" data-lang="PYTHON">In [<span style="color:#ae81ff">100</span>]: f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;123.txt&#39;</span>,<span style="color:#e6db74">&#39;r+&#39;</span>)

In [<span style="color:#ae81ff">101</span>]: <span style="color:#66d9ef">with</span> f:
     <span style="color:#f92672">...</span>:     f<span style="color:#f92672">.</span>read()
     <span style="color:#f92672">...</span>:

In [<span style="color:#ae81ff">102</span>]: f<span style="color:#f92672">.</span>closed
Out[<span style="color:#ae81ff">102</span>]: True
</code></pre></div><h2 id="16-文件对象的其他方法">1.6 文件对象的其他方法</h2>
<p>文件对象的内置方法还有很多种，如下所示：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fd<span style="color:#f92672">.</span>closed()<span style="color:#960050;background-color:#1e0010">：</span>    <span style="color:#960050;background-color:#1e0010">判断文件是否被关闭，若被打开提示</span>False<span style="color:#960050;background-color:#1e0010">，没有的话提示</span>True
fd<span style="color:#f92672">.</span>flush()<span style="color:#960050;background-color:#1e0010">：</span>     <span style="color:#960050;background-color:#1e0010">把修改的内容，强制刷新到文件中去</span>
fd<span style="color:#f92672">.</span>isatty<span style="color:#960050;background-color:#1e0010">：</span>      <span style="color:#960050;background-color:#1e0010">判断是否是一个终端文件</span>
fd<span style="color:#f92672">.</span>mode<span style="color:#960050;background-color:#1e0010">：</span>        <span style="color:#960050;background-color:#1e0010">查看文件的打开模式</span>
fd<span style="color:#f92672">.</span>name<span style="color:#960050;background-color:#1e0010">：</span>        <span style="color:#960050;background-color:#1e0010">查看文件的名称</span>
fd<span style="color:#f92672">.</span>next<span style="color:#960050;background-color:#1e0010">：</span>        <span style="color:#960050;background-color:#1e0010">迭代的方法，和</span>readline很像<span style="color:#960050;background-color:#1e0010">，区别是，</span>next读到末尾会报错<span style="color:#960050;background-color:#1e0010">，</span>readline会继续返回空
fd<span style="color:#f92672">.</span>read<span style="color:#960050;background-color:#1e0010">：</span>        <span style="color:#960050;background-color:#1e0010">一次性读取所有内容，以字符串的方式存取</span>
fd<span style="color:#f92672">.</span>readable():   <span style="color:#960050;background-color:#1e0010">判断文件是否可读</span>
fd<span style="color:#f92672">.</span>readlines<span style="color:#960050;background-color:#1e0010">：</span>   <span style="color:#960050;background-color:#1e0010">一次性读取所有内容，以列表的方式存取（适合操作小文件）</span>
fd<span style="color:#f92672">.</span>readline()<span style="color:#960050;background-color:#1e0010">：</span>  <span style="color:#960050;background-color:#1e0010">每次读取一行内容</span>
fd<span style="color:#f92672">.</span>seek(<span style="color:#ae81ff">0</span>)<span style="color:#960050;background-color:#1e0010">：</span>     <span style="color:#960050;background-color:#1e0010">调整文件读取的指针位置</span>
fd<span style="color:#f92672">.</span>seekable()<span style="color:#960050;background-color:#1e0010">：</span>  <span style="color:#960050;background-color:#1e0010">判断文件是否可以调整指针位置（</span>tty<span style="color:#960050;background-color:#1e0010">，磁盘等文件是不能被</span>seek的<span style="color:#960050;background-color:#1e0010">），可以被</span>seek则返回真<span style="color:#960050;background-color:#1e0010">，否则返回假</span>
fd<span style="color:#f92672">.</span>tell()<span style="color:#960050;background-color:#1e0010">：</span>      <span style="color:#960050;background-color:#1e0010">查询文件目前读取位置（以字符为单位）</span>
fd<span style="color:#f92672">.</span>truncate()<span style="color:#960050;background-color:#1e0010">：</span>  <span style="color:#960050;background-color:#1e0010">截取文件，从开头开始截取，不指定指针位置的话，那么会清空文件</span>
fd<span style="color:#f92672">.</span>write<span style="color:#960050;background-color:#1e0010">：</span>       <span style="color:#960050;background-color:#1e0010">把一个字符串写入到文件中去</span>
fd<span style="color:#f92672">.</span>writelines()<span style="color:#960050;background-color:#1e0010">：把字符串列表写入文件中</span>
fd<span style="color:#f92672">.</span>xreadlines()<span style="color:#960050;background-color:#1e0010">：读一行打印一行，针对大文件非常适用</span> <span style="color:#f92672">-----&gt;</span> Python <span style="color:#ae81ff">2.</span>x <span style="color:#960050;background-color:#1e0010">中适用，</span><span style="color:#ae81ff">3.</span>x中已经取消
fd<span style="color:#f92672">.</span>encoding:     <span style="color:#960050;background-color:#1e0010">查看文件的编码</span>
fd<span style="color:#f92672">.</span>writeable()<span style="color:#960050;background-color:#1e0010">：</span> <span style="color:#960050;background-color:#1e0010">判断文件是否可以写</span>
fd<span style="color:#f92672">.</span>fileno()<span style="color:#960050;background-color:#1e0010">：</span>    <span style="color:#960050;background-color:#1e0010">返回文件在操作系统上的文件描述符（一个进程的运行默认会打开三个特殊的文件描述符：</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">表示</span> stdin<span style="color:#960050;background-color:#1e0010">、</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">表示</span> stdout<span style="color:#960050;background-color:#1e0010">，</span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">表示</span>stderr<span style="color:#960050;background-color:#1e0010">）</span>
fd<span style="color:#f92672">.</span>name<span style="color:#960050;background-color:#1e0010">：</span>        <span style="color:#960050;background-color:#1e0010">文件名称</span> 
</code></pre></div><h1 id="2-stringio模块">2 StringIO模块</h1>
<p>        用于在内存空开辟一个文本模式的buffer,可以像文件对象一样操作它,当close方法被调用时,这个buffer会被释放.</p>
<blockquote>
<p>使用前需要先进行导入, from io import StringIO</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">In [<span style="color:#ae81ff">106</span>]: <span style="color:#f92672">from</span> io <span style="color:#f92672">import</span> StringIO

In [<span style="color:#ae81ff">107</span>]: s <span style="color:#f92672">=</span> StringIO()   <span style="color:#75715e"># 实例化一个StringIO对象用于读写,相当于 f = open(&#39;123.txt&#39;,&#39;r+&#39;)</span>

In [<span style="color:#ae81ff">108</span>]: s<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;123&#39;</span>)
Out[<span style="color:#ae81ff">108</span>]: <span style="color:#ae81ff">3</span>

In [<span style="color:#ae81ff">109</span>]: s<span style="color:#f92672">.</span>readline()
Out[<span style="color:#ae81ff">109</span>]: <span style="color:#e6db74">&#39;&#39;</span>

In [<span style="color:#ae81ff">110</span>]: s<span style="color:#f92672">.</span>seek(<span style="color:#ae81ff">0</span>)
Out[<span style="color:#ae81ff">110</span>]: <span style="color:#ae81ff">0</span>

In [<span style="color:#ae81ff">111</span>]: s<span style="color:#f92672">.</span>readline()
Out[<span style="color:#ae81ff">111</span>]: <span style="color:#e6db74">&#39;123&#39;</span>
</code></pre></div><p><code>getvalue()</code>: 获取全部内容,根文件指针没有关系.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">In [<span style="color:#ae81ff">106</span>]: <span style="color:#f92672">from</span> io <span style="color:#f92672">import</span> StringIO

In [<span style="color:#ae81ff">107</span>]: s <span style="color:#f92672">=</span> StringIO()

In [<span style="color:#ae81ff">108</span>]: s<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;123&#39;</span>)
Out[<span style="color:#ae81ff">108</span>]: <span style="color:#ae81ff">3</span>

In [<span style="color:#ae81ff">109</span>]: s<span style="color:#f92672">.</span>readline()
Out[<span style="color:#ae81ff">109</span>]: <span style="color:#e6db74">&#39;&#39;</span>

In [<span style="color:#ae81ff">110</span>]: s<span style="color:#f92672">.</span>seek(<span style="color:#ae81ff">0</span>)
Out[<span style="color:#ae81ff">110</span>]: <span style="color:#ae81ff">0</span>

In [<span style="color:#ae81ff">111</span>]: s<span style="color:#f92672">.</span>readline()    <span style="color:#75715e"># 指针已经切换到文件末尾</span>
Out[<span style="color:#ae81ff">111</span>]: <span style="color:#e6db74">&#39;123&#39;</span>

In [<span style="color:#ae81ff">112</span>]: s<span style="color:#f92672">.</span>getvalue()    <span style="color:#75715e"># 无视指针,可以读取所有</span>
Out[<span style="color:#ae81ff">112</span>]: <span style="color:#e6db74">&#39;123&#39;</span>
</code></pre></div><blockquote>
<p>一般来说,磁盘的操作比内存的操作要慢得多,内存足够的情况下,一般的优化思路是少落地,减少磁盘IO的过程,可以大大提高程序的运行效率.</p>
</blockquote>
<h1 id="3-bytesio模块">3 BytesIO模块</h1>
<p>        用于在内存中开辟一个二进制模式的buffer,可以像文件对象一样操作它,当close方法被调用时,这个buffer会被释放.</p>
<blockquote>
<p>调用前需要先导入: from io import BytesIO</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">In [<span style="color:#ae81ff">114</span>]: <span style="color:#f92672">from</span> io <span style="color:#f92672">import</span> BytesIO

In [<span style="color:#ae81ff">115</span>]: b <span style="color:#f92672">=</span> BytesIO()  <span style="color:#75715e"># 实例化一个BytesIO对象用于存储二进制数据</span>

In [<span style="color:#ae81ff">116</span>]: b<span style="color:#f92672">.</span>write(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;abc&#39;</span>)
Out[<span style="color:#ae81ff">116</span>]: <span style="color:#ae81ff">3</span>

In [<span style="color:#ae81ff">117</span>]: b<span style="color:#f92672">.</span>seek(<span style="color:#ae81ff">0</span>)
Out[<span style="color:#ae81ff">117</span>]: <span style="color:#ae81ff">0</span>

In [<span style="color:#ae81ff">118</span>]: b<span style="color:#f92672">.</span>read()
Out[<span style="color:#ae81ff">118</span>]: <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;abc&#39;</span>

In [<span style="color:#ae81ff">119</span>]: b<span style="color:#f92672">.</span>getvalue()   <span style="color:#75715e"># 同样无视指针的存在</span>
Out[<span style="color:#ae81ff">119</span>]: <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;abc&#39;</span>
</code></pre></div><p>        针对StringIO和BytesIO来说,还有如下方法:</p>
<ol>
<li>readable(): 可读吗?</li>
<li>writeable(): 可写吗?</li>
<li>seekable(): 可以调整指针吗?</li>
</ol>
<h1 id="4-file-like对象">4 file-like对象</h1>
<p>        类文件对象,可以向文件对象一个操作,比如socket对象,输入输出对象(stdin,stdout)等都是类文件对象.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">In [<span style="color:#ae81ff">120</span>]: <span style="color:#f92672">from</span> sys <span style="color:#f92672">import</span> stdin,stdout

In [<span style="color:#ae81ff">122</span>]: stdout<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;123&#39;</span>)
<span style="color:#ae81ff">123</span>
In [<span style="color:#ae81ff">123</span>]: type(stdout)
Out[<span style="color:#ae81ff">123</span>]: colorama<span style="color:#f92672">.</span>ansitowin32<span style="color:#f92672">.</span>StreamWrapper

In [<span style="color:#ae81ff">124</span>]:
</code></pre></div><p>每个程序初始化运行时,都会打开3个文件:</p>
<ul>
<li>stdin: 标准输入</li>
<li>stdout: 标准输出</li>
<li>stderr: 标准错误输出
{% endraw %}</li>
</ul>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "your_disqus_shortname";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "your_disqus_shortname";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="https://dachenzi.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

