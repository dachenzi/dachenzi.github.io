<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>LinuxUser  &middot; dahl&#39;s blog</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="">


<meta property="og:title" content="LinuxUser  &middot; dahl&#39;s blog ">
<meta property="og:site_name" content="dahl&#39;s blog"/>
<meta property="og:url" content="https://dachenzi.github.io/linux/os/linuxuser/" />
<meta property="og:locale" content="en-EN">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="0001-01-01T00:00:00Z" />
<meta property="og:article:modified_time" content="0001-01-01T00:00:00Z" />

  
    
  

  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "LinuxUser",
    "author": {
      "@type": "Person",
      "name": "daxin.li"
    },
    "datePublished": "0001-01-01",
    "description": "",
    "wordCount":  1653 
  }
</script>



<link rel="canonical" href="https://dachenzi.github.io/linux/os/linuxuser/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://dachenzi.github.io/touch-icon-144-precomposed.png">
<link href="https://dachenzi.github.io/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.75.1" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link href='https://fonts.googleapis.com/css?family=Merriweather:300%7CRaleway%7COpen+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/highlight/default.css">

  
  
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'Your Google Analytics tracking code', 'auto');
	  ga('send', 'pageview');

	</script>

</head>
<body>
  <main id="main-wrapper" class="container main_wrapper has-sidebar">
    <header id="main-header" class="container main_header">
  <div class="container brand">
  <div class="container title h1-like">
  <a class="baselink" href="https://dachenzi.github.io">
  foobar

</a>

</div>

  
<div class="container topline">
  
  few words about your site


</div>


</div>

  <nav class="container nav primary no-print">
  

<a class="homelink" href="https://dachenzi.github.io">home</a>


  
<a href="https://dachenzi.github.io/about">About</a>

<a href="https://dachenzi.github.io/post" title="Show list of posts">Posts</a>

<a href="https://dachenzi.github.io/tags" title="Show list of tags">Tags</a>


</nav>

<div class="container nav secondary no-print">
  
<a id="contact-link-email" class="contact_link" rel="me" aria-label="Email" href="mailto:dahlhin.li@gmail.com">
  <span class="fa fa-envelope-square"></span></a>



<a id="contact-link-github" class="contact_link" rel="me" aria-label="Github" href="https://github.com/enten/hugo-boilerplate">
  <span class="fa fa-github-square"></span></a>




 


















</div>


  

</header>


<article id="main-content" class="container main_content single">
  <header class="container hat">
  <h1>LinuxUser
</h1>

</header>

  <div class="container content">
  <p>{% raw %}</p>
<h1 id="1-小知识点回顾">1 小知识点回顾</h1>
<ul>
<li>Linux 是一个多用户多任务操作系统。</li>
<li>每个文件和进程，都需要对应一个用户和用户组。</li>
<li>Linux系统是通过UID和GID来识别用户和组的。</li>
<li>用户名相当于人名（给人看的）,UID，GID相当于身份证号（系统用的）</li>
<li>Linux管理员：root</li>
<li>用户和组的关系：1对1、1对多、多对1、多对多</li>
<li>Linux系统用户的分类：
<ul>
<li>超级用户：UID为0，代表皇帝。</li>
<li>普通用户：UID为500-65535，由皇帝创建的普通用户，大臣。</li>
<li>虚拟用户：UID为1-499，，为了满足程序启动的需要。</li>
</ul>
</li>
<li>和用户关联的四个文件:<code>/etc/passwd,/etc/shadow,/etc/group,/etc/gshadow</code></li>
</ul>
<h1 id="2-环境变量配置文件-etcskel">2 环境变量配置文件 /etc/skel</h1>
<p>        当我们创建一个用户的时候，他的家目录下面默认会有一些隐藏文件，比如<code>.bashrc、.bash_histoy、.bash_profile</code>这些文件从哪来的?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># ls -la</span>
dr-xr-x---.  <span style="color:#ae81ff">3</span> root root  <span style="color:#ae81ff">4096</span> Apr  <span style="color:#ae81ff">1</span> 22:39 .
dr-xr-xr-x. <span style="color:#ae81ff">25</span> root root  <span style="color:#ae81ff">4096</span> Apr  <span style="color:#ae81ff">1</span> 21:51 ..
-rw-------.  <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">20481</span> Apr  <span style="color:#ae81ff">1</span> 20:08 .bash_history
-rw-r--r--.  <span style="color:#ae81ff">1</span> root root    <span style="color:#ae81ff">18</span> May <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2009</span> .bash_logout
-rw-r--r--.  <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">176</span> May <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">2009</span> .bash_profile
-rw-r--r--.  <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">176</span> Sep <span style="color:#ae81ff">23</span>  <span style="color:#ae81ff">2004</span> .bashrc
<span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># ls -la /etc/skel</span>
total <span style="color:#ae81ff">24</span>
drwxr-xr-x.  <span style="color:#ae81ff">3</span> root root <span style="color:#ae81ff">4096</span> Mar  <span style="color:#ae81ff">3</span> 23:26 .
drwxr-xr-x. <span style="color:#ae81ff">91</span> root root <span style="color:#ae81ff">4096</span> Apr  <span style="color:#ae81ff">1</span> 21:51 ..
-rw-r--r--.  <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">18</span> Jul <span style="color:#ae81ff">24</span>  <span style="color:#ae81ff">2015</span> .bash_logout
-rw-r--r--.  <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">176</span> Jul <span style="color:#ae81ff">24</span>  <span style="color:#ae81ff">2015</span> .bash_profile
-rw-r--r--.  <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">124</span> Jul <span style="color:#ae81ff">24</span>  <span style="color:#ae81ff">2015</span> .bashrc
drwxr-xr-x.  <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Nov <span style="color:#ae81ff">12</span>  <span style="color:#ae81ff">2010</span> .gnome2
<span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</code></pre></div><p><strong>对了，其实当我们执行<code>useradd</code>命令的时候，就相当于把<code>/etc/skel/</code>下的文件拷贝到了用户的家目录下。</strong></p>
<h2 id="21-异常例子">2.1 异常例子</h2>
<p>某日用户反馈，他的账号登陆上来有如下提示，如何解决?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">-bash-4.1$ 
-bash-4.1$ 
-bash-4.1$ 
-bash-4.1$
</code></pre></div><p>1.由于shell提示符是由PS1变量来提供的，查看PS1变量内容</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">-bash-4.1$ echo $PS1
<span style="color:#ae81ff">\s</span>-<span style="color:#ae81ff">\v\$</span>
-bash-4.1$
</code></pre></div><p>2.发现PS1环境变量错误，使用env后发现用户的环境变量错误，查看用户家目录下的环境变量发现没有。解决方法，把<code>/etc/skel</code>目录下的环境变量复制到用户的家目录下即可。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">-bash-4.1$ cp /etc/skel/.bash* ~/
-bash-4.1$ cd ~/
-bash-4.1$ ls -la
drwxr-xr-x   <span style="color:#ae81ff">3</span> stu1 stu1 <span style="color:#ae81ff">4096</span> Apr  <span style="color:#ae81ff">1</span> 23:16 .
drwxr-xr-x. <span style="color:#ae81ff">14</span> root root <span style="color:#ae81ff">4096</span> Apr  <span style="color:#ae81ff">1</span> 16:06 ..
-rw-------   <span style="color:#ae81ff">1</span> stu1 stu1   <span style="color:#ae81ff">44</span> Apr  <span style="color:#ae81ff">1</span> 23:09 .bash_history
-rw-r--r--   <span style="color:#ae81ff">1</span> stu1 stu1   <span style="color:#ae81ff">18</span> Apr  <span style="color:#ae81ff">1</span> 23:16 .bash_logout
-rw-r--r--   <span style="color:#ae81ff">1</span> stu1 stu1  <span style="color:#ae81ff">176</span> Apr  <span style="color:#ae81ff">1</span> 23:16 .bash_profile
-rw-r--r--   <span style="color:#ae81ff">1</span> stu1 stu1  <span style="color:#ae81ff">124</span> Apr  <span style="color:#ae81ff">1</span> 23:16 .bashrc
drwxr-xr-x   <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">31</span> 16:29 .gnome2
</code></pre></div><p>重新登陆后，正常！</p>
<h2 id="22-小技巧">2.2. 小技巧</h2>
<p>        把一些说明性的文件，放在该目录下，创建用户的时候会直接复制到用户的家目录初始化用户的环境变量(可以把环境变量写入到<code>/etc/skel/.bash_profile</code>中。这样再创建用户后，就会统一使用该环境变量，达到初始化的目的</p>
<h1 id="3-用户配置信息文件">3 用户配置信息文件</h1>
<h2 id="31-设置用户账号限制的文件">3.1 设置用户账号限制的文件</h2>
<p><strong><code>/etc/login.defs</code></strong><br>
当我们创建用户时，用户默认的UID为500以上，默认会创建用户的邮箱文件<code>/var/spool/mail</code>,那么这些信息是由谁来定义的呢。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin etc<span style="color:#f92672">]</span><span style="color:#75715e"># grep &#34;^[^#]&#34; login.defs </span>
MAIL_DIR        /var/spool/mail  <span style="color:#75715e">#创建用户是，在/var/spool/mail下创建邮件目录</span>
PASS_MAX_DAYS   <span style="color:#ae81ff">99999</span>      <span style="color:#75715e">#创建用户的默认密码最大有效期</span>
PASS_MIN_DAYS   <span style="color:#ae81ff">0</span>        <span style="color:#75715e">#两次修改密码的最小间隔时间</span>
PASS_MIN_LEN    <span style="color:#ae81ff">5</span>        <span style="color:#75715e">#密码的最小长度</span>
PASS_WARN_AGE   <span style="color:#ae81ff">7</span>        <span style="color:#75715e">#密码过期前的提醒时间</span>
UID_MIN                   <span style="color:#ae81ff">500</span>    <span style="color:#75715e">#创建用户时，最小UID</span>
UID_MAX                 <span style="color:#ae81ff">60000</span>  <span style="color:#75715e">#创建用户时，最大UID</span>
GID_MIN                   <span style="color:#ae81ff">500</span>   <span style="color:#75715e">#创建用户时，最小GID</span>
GID_MAX                 <span style="color:#ae81ff">60000</span>  <span style="color:#75715e">#创建用户时，最大GID</span>
CREATE_HOME     yes        <span style="color:#75715e">#同时创建用户的家目录</span>
UMASK           <span style="color:#ae81ff">077</span>      <span style="color:#75715e">#用户家目录的umask，（用户家目录权限700）</span>
USERGROUPS_ENAB yes       <span style="color:#75715e">#创建用户时，并创建同名用户组</span>
ENCRYPT_METHOD SHA512       <span style="color:#75715e">#密码使用SHA512加密</span>
<span style="color:#f92672">[</span>root@lixin etc<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</code></pre></div><h2 id="32-创建用户的默认配置文件">3.2 创建用户的默认配置文件</h2>
<p><strong><code>/etc/defualt/useradd</code></strong><br>
当我们创建用户的时候，为什么会去<code>/etc/skel</code>下复制变量文件？为什么会在home下创建用户的家目录？为什么会指定用户的shell为<code>/bin/bash</code>?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin default<span style="color:#f92672">]</span><span style="color:#75715e"># cat useradd </span>
<span style="color:#75715e"># useradd defaults file</span>
GROUP<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span> <span style="color:#75715e">#创建用户时的默认组GID，如果login.defs创建同名组，则login.defs优先</span>
HOME<span style="color:#f92672">=</span>/home     <span style="color:#75715e">#在home下创建用户的家目录</span>
INACTIVE<span style="color:#f92672">=</span>-1     <span style="color:#75715e">#是否使用账号过期停权，-1表示不启动</span>
EXPIRE<span style="color:#f92672">=</span>       <span style="color:#75715e">#账号终止日期，不设置表示不启用</span>
SHELL<span style="color:#f92672">=</span>/bin/bash   <span style="color:#75715e">#设置用户的默认shell为/bin/shell</span>
SKEL<span style="color:#f92672">=</span>/etc/skel      <span style="color:#75715e">#用户环境变量目录</span>
CREATE_MAIL_SPOOL<span style="color:#f92672">=</span>yes <span style="color:#75715e">#创建用户mail目录，目录在login.defs中定义</span>
<span style="color:#f92672">[</span>root@lixin default<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</code></pre></div><p>当我们使用命令<code>useradd</code>，来创建用户的时候，它默认会按照该文件中定义的去执行，比如环境变量在<code>/etc/skel</code>下，家目录路在<code>/home</code>下。生产环境下一般不去修改该文件内容。</p>
<h2 id="33-小结">3.3 小结</h2>
<ul>
<li><code>/etc/skel</code>：存放用户的环境变量文件。</li>
<li><code>/etc/login.defs</code>：用来设置用户账号限制的文件。</li>
<li><code>/etc/default/useradd</code>：创建用户的默认配置文件。</li>
</ul>
<h1 id="4-用户管理相关命令">4 用户管理相关命令</h1>
<h2 id="41-useradd">4.1 useradd</h2>
<p>用于创建Linux系统中的账户<br>
语法格式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">useradd <span style="color:#f92672">[</span>选项<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>参数<span style="color:#f92672">]</span>

常用选项
-c：创建用户时，添加账户说明信息。
-d：指定用户的家目录。
-e：指定用户的终止期限，日期格式为‘mm/yy/dd’。
-g：指定用户的所属组，可以是组名，或者GID。（必须已存在）
-G：指定用户的附加组，可以是组名，或者是GID。（必须已存在）
-s：指定用户的shell，默认情况下系统会根据/etc/default/useradd设定用户的shell。
-u：指定用户的UID，不存在，且唯一。
-M：不创建用户家目录。（默认为-m，创建用户家目录）
-n：取消建立同名的用户组名。

参数
    要创建的用户名
</code></pre></div><p>实例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># useradd -c &#39;this is boy&#39; -d /home/handsomeboy/ -e &#39;2016/11/11&#39; -g handsomeboy -G root -s /sbin/nologin -u 800 -M -n lixin</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># tail -1 /etc/passwd    #用户UID，GID，描述，家目录，shell均已更改</span>
lixin:x:800:513:this is boy:/home/handsomeboy/:/sbin/nologin
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># id lixin   #所属组，和附加组也以更改</span>
uid<span style="color:#f92672">=</span>800<span style="color:#f92672">(</span>lixin<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>513<span style="color:#f92672">(</span>handsomeboy<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>513<span style="color:#f92672">(</span>handsomeboy<span style="color:#f92672">)</span>,0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># ls -l /home</span>
total <span style="color:#ae81ff">44</span>        <span style="color:#75715e">#没有创建同名家目录</span>
drwxr-xr-x <span style="color:#ae81ff">2</span> root  root  <span style="color:#ae81ff">4096</span> Apr  <span style="color:#ae81ff">2</span> 14:32 handsomeboy
drwxr-xr-x <span style="color:#ae81ff">3</span> stu1  stu1  <span style="color:#ae81ff">4096</span> Apr  <span style="color:#ae81ff">1</span> 23:16 stu1
drwx------ <span style="color:#ae81ff">3</span> stu10 stu10 <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu10
drwx------ <span style="color:#ae81ff">3</span> stu2  stu2  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu2
drwx------ <span style="color:#ae81ff">3</span> stu3  stu3  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu3
drwx------ <span style="color:#ae81ff">3</span> stu4  stu4  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu4
drwx------ <span style="color:#ae81ff">3</span> stu5  stu5  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu5
drwx------ <span style="color:#ae81ff">3</span> stu6  stu6  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu6
drwx------ <span style="color:#ae81ff">3</span> stu7  stu7  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu7
drwx------ <span style="color:#ae81ff">3</span> stu8  stu8  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu8
drwx------ <span style="color:#ae81ff">3</span> stu9  stu9  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu9
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># tail -1 /etc/group</span>
handsomeboy:x:513:    <span style="color:#75715e">#没有创建同名用户组</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># chage -l lixin</span>
Last password change                                    : Apr 02, <span style="color:#ae81ff">2016</span>
Password expires                                        : never
Password inactive                                       : never
Account expires                                         : Nov 11, <span style="color:#ae81ff">2016</span> <span style="color:#75715e">#账号期限</span>
Minimum number of days between password change          : <span style="color:#ae81ff">0</span>
Maximum number of days between password change          : <span style="color:#ae81ff">99999</span>
Number of days of warning before password expires       : <span style="color:#ae81ff">7</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span>
4.1.1 /etc/passwd文件
<span style="color:#75715e"># 当我们创建一个用户之后，它会把用户的信息存放在/etc/passwd文件中，如图：</span>
</code></pre></div><p>各字段含义：</p>
<ul>
<li>第一段：表示用户的名称</li>
<li>第二段：表示用户的密码</li>
<li>第三段：表示用户的UID</li>
<li>第四段：表示用户的GID</li>
<li>第五段：表示用户的描述信息</li>
<li>第六段：表示用户的家目录</li>
<li>第七段：表示用户的shell信息</li>
</ul>
<p>小结：</p>
<ul>
<li>a)  用户UID范围是0-65535，root用户的UID为0，1-499表示虚拟用户的UID，500-65535表示普通用户的UID，默认在<code>/etc/login.defs</code>文件中定义的范围是500-60000</li>
<li>b)  用户的密码信息，已经被定义到了<code>/etc/shadow</code>文件中，这里用x表示</li>
<li>c)  指定的家目录必须是已存在的</li>
<li>d)  系统支持的shell有：sh、bash、nologin、dash、tcsh、csh存放在<code>/etc/shells</code>文件中</li>
<li>e)  当我们创建用户时，系统会同时更改<code>/etc/passwd、/etc/shadown、/etc/group、/etc/gshadow</code>四个文件</li>
</ul>
<h2 id="42-groupadd">4.2 groupadd</h2>
<p>用户创建Linux系统中的用户组</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">语法格式
groupadd <span style="color:#f92672">[</span>选项<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>参数<span style="color:#f92672">]</span>

常用选项
-g：指定用户的GID，不存在，且唯一。

参数
要创建的用户组的组名
</code></pre></div><p>实例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># groupadd -g 1000 xiaoming</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># tail -1 /etc/group</span>
xiaoming:x:1000:
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</code></pre></div><h3 id="421-etcgroup文件">4.2.1 /etc/group文件</h3>
<p>当我们创建一个用户组之后，Linux会把组相关信息存放在/etc/group文件中，如图：<br>
各字段含义：</p>
<ul>
<li>第一段：表示用户组的名称</li>
<li>第二段：表示用户组的密码</li>
<li>第三段：表示用户组的GID</li>
<li>第四段：表示用户组内的成员</li>
</ul>
<p>小结：</p>
<ul>
<li>a)  用户组密码存放位置已经改为/etc/gshadow，这里用x表示，用户组密码现在已经很少使用。</li>
<li>b)  用户组的ID，范围是0-65535，其中0是root的用户组，1-499是虚拟用户对应的用户组，500-65535，才是普通用户对应的用户组，默认在/etc/login.defs中定义了范围是500-60000。</li>
<li>c)  当组中只存在和组同名的用户名时，组内成员这一列可以省略。</li>
<li>d)  当我们创建用户组的时候会更改/etc/group、/etc/gshadow文件。</li>
</ul>
<h2 id="43-groupdel">4.3 groupdel</h2>
<p>删除Linux系统中的用户组，前提该用户组中没有成员。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">语法格式
groupdel <span style="color:#f92672">[</span>参数<span style="color:#f92672">]</span>

参数
要删除的用户组的组名
</code></pre></div><p>实例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># groupdel xiaoming  #删除用户组</span>
groupdel: cannot remove the primary group of user <span style="color:#e6db74">&#39;lixin&#39;</span>  <span style="color:#75715e">#提示该组下存在用户lixin</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># userdel -r lixin     #删除用户lixin</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># groupdel xiaoming    #成功删除xiaoming用户组</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</code></pre></div><h2 id="44-passwd">4.4 passwd</h2>
<p>修改Linux系统中的用户密码，以及密码相关信息，root用户可以修改任何人密码，普通用户只能修改自己的密码。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">语法格式
passwd <span style="color:#f92672">[</span>选项<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>参数<span style="color:#f92672">]</span>

常用选项
--stdin：接受标准输入作为用户的密码（非交互式修改密码）。
-d：删除用户密码，仅管理员有权限执行。
-l：锁住密码
-u：解开上锁的账户

参数
要修改信息的账户名，省略表示修改当前用户
</code></pre></div><p>实例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># useradd lixin   #使用123456，为用户lixin的密码</span>
<span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># echo &#39;123456&#39; | passwd --stdin lixin</span>
Changing password <span style="color:#66d9ef">for</span> user lixin.
passwd: all authentication tokens updated successfully.
<span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e">#   #此方法多用户脚本中</span>
</code></pre></div><h2 id="45-chage">4.5 chage</h2>
<p>用来修改用户密码到期相关信息</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">语法格式
chage <span style="color:#f92672">[</span>选项<span style="color:#f92672">]</span> 用户名

常用选项
-m：密码可更改的最小天数。为零时代表任何时候都可以更改密码
-M：密码保持有效的最大天数。 
-w：用户密码到期前，提前收到警告信息的天数。 
-E：帐号到期的日期。过了这天，此帐号将不可用。 
-I：停滞时期。如果一个密码已过期这些天，那么此帐号将不可用。 
-L<span style="color:#f92672">(</span>小写<span style="color:#f92672">)</span>：例出当前的设置。
</code></pre></div><p>实例<br>
查看当前用户密码信息</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># chage -l root</span>
Last password change                                    : Mar 03, <span style="color:#ae81ff">2016</span>
Password expires                                        : never
Password inactive                                       : never
Account expires                                         : never
Minimum number of days between password change          : <span style="color:#ae81ff">0</span>
Maximum number of days between password change          : <span style="color:#ae81ff">99999</span>
Number of days of warning before password expires       : <span style="color:#ae81ff">7</span>
</code></pre></div><p>各字段含义：</p>
<ul>
<li>Last password change：最后一次修改密码的时间</li>
<li>Password expires：密码过期时间</li>
<li>Password inactive：密码禁用时间</li>
<li>Account expires：账号停用时间</li>
<li>Minimum number of days between password change：最小修改密码时间</li>
<li>Maximum number of days between password change：最大修改密码时间</li>
<li>Number of days of warning before password expires：密码过期前多久开始提醒</li>
</ul>
<p>修改用户密码相关信息</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># chage -d &#39;2020/01/01&#39; -E &#39;2020/02/01&#39; -I 60  -m 7 -M 30 -W 15 stu1</span>
<span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># chage -l stu1</span>
Last password change          : Jan 01, <span style="color:#ae81ff">2020</span>
Password expires          : Jan 31, <span style="color:#ae81ff">2020</span>
Password inactive         : Mar 31, <span style="color:#ae81ff">2020</span>
Account expires           : Feb 01, <span style="color:#ae81ff">2020</span>
Minimum number of days between password change    : <span style="color:#ae81ff">7</span>
Maximum number of days between password change    : <span style="color:#ae81ff">30</span>
Number of days of warning before password expires : <span style="color:#ae81ff">15</span>
<span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</code></pre></div><p>小技巧</p>
<ul>
<li>使用passwd和chage等均可以设置或更改指定帐户密码的安全信息，我们也可以通过/etc/login.defs配置文件或/etc/defaule/useradd针对所有帐户全局生效。</li>
<li>设置用户密码的时效有利有弊：优点是可以防止运维人员离职一段时间后发现用户还可以登陆（也可能不是自己的用户），如果设置了帐户有效期，即使用户未被清理，那么一段时间内也会因为密码失效而被自动锁定。密码时效还可以强制系统管理人员定期修改密码，提示系统安全性。缺点是有一些本来应该保留的用户也因为过期而无法登陆了，另外，在服务器数量很多的情况下唉，更改密码也是很大的工作量。在大规模的运维环境中，使用LDAP（微软活动目录）对Linux帐户统一认证，批量管理，也是不错的方法。</li>
</ul>
<h2 id="46-userdel">4.6 userdel</h2>
<p>删除Linux系统中的用户</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">语法格式
userdel <span style="color:#f92672">[</span>选项<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>参数<span style="color:#f92672">]</span>

常用选项
-r：删除用户，同时删除用户的家目录

参数
要删除的用户名
</code></pre></div><p>实例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># userdel -r lixin  #删除用户，同时删除用户的家目录</span>
<span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># ls -l /home</span>
total <span style="color:#ae81ff">44</span>
drwxr-xr-x <span style="color:#ae81ff">2</span> root  root  <span style="color:#ae81ff">4096</span> Apr  <span style="color:#ae81ff">2</span> 14:32 handsomeboy
drwxr-xr-x <span style="color:#ae81ff">3</span> stu1  stu1  <span style="color:#ae81ff">4096</span> Apr  <span style="color:#ae81ff">1</span> 23:16 stu1
drwx------ <span style="color:#ae81ff">3</span> stu4  stu4  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu4
drwx------ <span style="color:#ae81ff">3</span> stu5  stu5  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu5
drwx------ <span style="color:#ae81ff">3</span> stu6  stu6  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu6
drwx------ <span style="color:#ae81ff">3</span> stu7  stu7  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu7
drwx------ <span style="color:#ae81ff">3</span> stu8  stu8  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu8
drwx------ <span style="color:#ae81ff">3</span> stu9  stu9  <span style="color:#ae81ff">4096</span> Mar <span style="color:#ae81ff">30</span> 18:13 stu9
<span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</code></pre></div><blockquote>
<p>小技巧<br>
一般不能确认用户相关目录有没有重要数据就不能用-r。<br>
vi <code>/etc/passwd</code>，注释掉用户，观察一个月，这样出问题就可以恢复<br>
把登陆shell改为<code>/sbin/nologin</code><br>
ladp（类似活动目录）帐号同意管理，库里干掉用户，全部都没了。</p>
</blockquote>
<h2 id="47-usermod">4.7 usermod</h2>
<p>该命令用于修改用户的相关信息</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">语法格式
usermod <span style="color:#f92672">[</span>选项<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>参数<span style="color:#f92672">]</span>

常用参数
-d:修改用户的家目录。
-s:修改用户的shell。
-u：修改用户的UID
-g：修改用户的所属组
-G：修改用户的附加组
-c：修改用户的描述信息。
-e：修改用户的过期时间。
</code></pre></div><p>实例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># tail -1 /etc/passwd</span>
stu10:x:510:510::/home/stu10:/bin/bash
<span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># usermod -u 1000 -d /tmp -c &#39;i am boy&#39; -g root -s /sbin/nologin stu10</span>
<span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># tail -1 /etc/passwd</span>
stu10:x:1000:0:i am boy:/tmp:/sbin/nologin
<span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</code></pre></div><h2 id="48-su">4.8 su</h2>
<p>用来切换当前用户到其他用户</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">语法格式
su <span style="color:#f92672">[</span>选项<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>参数<span style="color:#f92672">]</span>

常用选项
-：表示切换用户，同时切换用户的环境变量。
-c &lt;command&gt;:表示以某个用户的身份执行一条命令。

参数
要切换的用户名
</code></pre></div><p>实例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># su - stu1 -c whoami  #以stu1用户执行whoami命令</span>
stu1
<span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</code></pre></div><p>小技巧<br>
当我们开机需要用某个身份运行某个服务的时候</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># su - apache -c /etc/init.d/apache restart</span>
<span style="color:#f92672">[</span>root@lixin ~<span style="color:#f92672">]</span><span style="color:#75715e"># #该命令写入rc.local中就可以了</span>
</code></pre></div><blockquote>
<p>扩展：<br>
        切换用户身份的su命令为我们管理Linux系统带来了很多方便，通过切换到root下，可以完成各种系统管理工作，只要任何一个普通用户知道了root用户的密码，都能以普通用户的身份切换到root下来完成无法完成的系统管理的工作。<br>
        但是，这样通过su命令切换到root后，也带来了很大安全管理问题：比如系统有8个用户，都可以通过切换到root身份进行系统管理，甚至还可以改掉root密码，让其他的普通用户无法再实现系统管理，还有，这么多用户中，有任何一人对系统操作的重大失误，都可能导致整个系统崩溃或数据损失。这样的非集中权式管理，在一定程度上就对系统的安全造成了较大的威胁。在工作中几乎有一般的问题来自于内部。<br>
        所以使用su命令切换身份在多个系统管理员共同管理的场合，并不是最好的选择,我们可以用sudo命令解决该问题。</p>
</blockquote>
<h2 id="49-newgrp">4.9 newgrp</h2>
<p>更改当前用户的属组信息，类似于su，su是切换当前用户到目标用户，newgrp是切换当前用户组到目标用户组。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">语法格式
newgrp <span style="color:#f92672">[</span>参数<span style="color:#f92672">]</span>

参数
要切换到的目标用户组的组名
</code></pre></div><p>实例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin tmp<span style="color:#f92672">]</span><span style="color:#75715e"># newgrp stu01  #切换用户的属组</span>
<span style="color:#f92672">[</span>root@lixin tmp<span style="color:#f92672">]</span><span style="color:#75715e"># id </span>
uid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>stu01<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>stu01<span style="color:#f92672">)</span>,0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>root@lixin tmp<span style="color:#f92672">]</span><span style="color:#75715e"># touch 12  #创建文件后发现文件的属组已更改</span>
<span style="color:#f92672">[</span>root@lixin tmp<span style="color:#f92672">]</span><span style="color:#75715e"># ls -l 12</span>
-rw-r--r-- <span style="color:#ae81ff">1</span> root stu01 <span style="color:#ae81ff">0</span> Apr  <span style="color:#ae81ff">3</span> 16:16 <span style="color:#ae81ff">12</span>
<span style="color:#f92672">[</span>root@lixin tmp<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</code></pre></div><h1 id="5-sudu命令详解">5 sudu命令详解</h1>
<p>        普通用户必须知道root密码才可以切换到root，这样root密码就泄露了。相当于把“枪”交给了别人。<br>
        使用su命令切换身份，无法对切换后的身份做精细的控制，拿到超级权限的人可以为所欲为。甚至可以改掉root密码，让真正的管理员无法拥有root权限。<br>
        通过sudo命令，我们可以把某些超级用户权限分类有针对性的授权给指定用户，并且普通用户不需要知道root密码就可以使用得到的授权（管理员真正允许的root权限）。因此sudo命令比su命令在权限管理上来说更精细，更安全。</p>
<h2 id="51-sudu原理">5.1 sudu原理</h2>
<p>        普通用户通过在要执行的命令前加sudo来启动sudo权限，系统首先检测/var/db/sudo/username（对应的用户名）的时间戳文件，默认是5分钟，若过期则需要输入当前用户的密码，若没有过期则直接进入/etc/visudo文件中，查找该用户是否被sudo授权了该命令，若授权，则返回结果后退出sudo权限，若没有授权，则直接退出sudo权限。<br>
如下图：<br>
<img src="photo/sudo.png" alt="sudo"></p>
<h2 id="52-配置文件解析">5.2 配置文件解析</h2>
<p><code>/etc/sudoers</code><br>
该文件主要定义用户权限的语法是：<br>
<img src="photo/sudoers.png" alt="sudoers"><br>
各字段含义：</p>
<ul>
<li>第一段：表示可以使用sudo权限的用户或用户组或者用户集合的别名</li>
<li>第二段：主机名（或主机别名，可以定义多个主机）=（要切换到的用户，一般是root）可以省略，默认是root。</li>
<li>第三段：表示可以执行的权限(注意多个命令用，隔开。如果执行sudo不想输入密码可以在命令前加入<code>NOPASSWD</code>：，也可以用/bin/*表示/bin下的所有命令)</li>
</ul>
<h2 id="53-配置方法">5.3 配置方法</h2>
<p>        用visudo命令直接对<code>/etc/sudoers</code>文件进行编辑，效果等同于vi <code>/etc/sudoers</code>，但是visudo默认带语法检查，如果我们使用vi <code>/etc/sudoers</code>对文件进行编辑的时候，需要使用visudo –c 来检查该文件的正确性。</p>
<h3 id="531-visudo">5.3.1 visudo</h3>
<p>编辑sudo配置文件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">语法格式
visudo <span style="color:#f92672">[</span>选项<span style="color:#f92672">]</span>

常用选项
-c：检查/etc/sudoers文件的语法是否正确
</code></pre></div><p>实例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin etc<span style="color:#f92672">]</span><span style="color:#75715e"># visudo -c</span>
/etc/sudoers: parsed OK
<span style="color:#f92672">[</span>root@lixin etc<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</code></pre></div><h3 id="532-sudo">5.3.2 sudo</h3>
<p>使用其他用户执行命令</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">语法格式
sudo <span style="color:#f92672">[</span>选项<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>参数<span style="color:#f92672">]</span>

常用选项
-l：列出当前用户可以执行的sudo权限
-k：清除用户的时间戳文件（下一次执行sudo将要输入密码）

参数
要执行的命令
</code></pre></div><p>实例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin etc<span style="color:#f92672">]</span><span style="color:#75715e"># sudo -l</span>
Matching Defaults entries <span style="color:#66d9ef">for</span> root on this host:
requiretty, !visiblepw, always_set_home, env_reset, env_keep<span style="color:#f92672">=</span><span style="color:#ae81ff">\&#34;</span>COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS<span style="color:#ae81ff">\&#34;</span>, env_keep+<span style="color:#ae81ff">\&#34;</span>MAIL PS1
secure_path<span style="color:#f92672">=</span>/sbin<span style="color:#ae81ff">\:</span>/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin
……
User root may run the following commands on this host:
<span style="color:#f92672">(</span>ALL<span style="color:#f92672">)</span> ALL       <span style="color:#75715e">#说明我可以切换到任何用户下执行任何命令</span>
<span style="color:#f92672">[</span>root@lixin etc<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</code></pre></div><h2 id="54实例">5.4实例</h2>
<ol>
<li>使stu1用户可以使用rm命令删除属于root的文件</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">##第一部分，测试时候可以删除root用户文件</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># ls -l</span>
drwxr-xr-x <span style="color:#ae81ff">2</span> root  root  <span style="color:#ae81ff">4096</span> Apr  <span style="color:#ae81ff">2</span> 14:32 handsomeboy
<span style="color:#f92672">[</span>stu1@lixin home<span style="color:#f92672">]</span>$ rm -rf handsomeboy   
rm: cannot remove <span style="color:#e6db74">&#39;handsomeboy&#39;</span>: Permission denied   <span style="color:#75715e">#被拒绝</span>
<span style="color:#f92672">[</span>stu1@lixin home<span style="color:#f92672">]</span>$ sudo rm -rf handsomeboy
<span style="color:#f92672">[</span>sudo<span style="color:#f92672">]</span> password <span style="color:#66d9ef">for</span> stu1: 
stu1 is not in the sudoers file.  This incident will be reported.
<span style="color:#f92672">[</span>stu1@lixin home<span style="color:#f92672">]</span>$

<span style="color:#75715e">##第二部分root用户授权stu1用户rm命令的sudo权限</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># echo &#39;stu1     ALL=(root)     /bin/rm&#39; &gt;&gt; /etc/sudoers</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># visudo –c  # 检查语法</span>
/etc/sudoers: parsed OK
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># tail -1 /etc/sudoers</span>
stu1     ALL<span style="color:#f92672">=(</span>root<span style="color:#f92672">)</span>     /bin/rm
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e">#</span>

<span style="color:#75715e">##第三部分测试stu1用户sudo 权限</span>
<span style="color:#f92672">[</span>stu1@lixin home<span style="color:#f92672">]</span>$ ls -l
drwxr-xr-x <span style="color:#ae81ff">2</span> root  root  <span style="color:#ae81ff">4096</span> Apr  <span style="color:#ae81ff">2</span> 14:32 handsomeboy
<span style="color:#f92672">[</span>stu1@lixin home<span style="color:#f92672">]</span>$ rm -rf handsomeboy
rm: cannot remove <span style="color:#e6db74">&#39;handsomeboy&#39;</span>: Permission denied
<span style="color:#f92672">[</span>stu1@lixin home<span style="color:#f92672">]</span>$ sudo rm -rf handsomeboy
<span style="color:#f92672">[</span>sudo<span style="color:#f92672">]</span> password <span style="color:#66d9ef">for</span> stu1: 
<span style="color:#f92672">[</span>stu1@lixin home<span style="color:#f92672">]</span>$ ls -l
<span style="color:#f92672">[</span>stu1@lixin home<span style="color:#f92672">]</span>$    <span style="color:#75715e">#使用sudo权限后，删除root文件成功！</span>

注意：
正常编写sudoers文件需要使用visudo命令进入sudoers文件中进行编写，不要使用echo 的方式追加，避免出现问题
扩展
使用别名定义多个用户多个命令集合
<span style="color:#75715e">##定义用户、主机、命令别名</span>
visudo；
Host_Alias LOCALHOST <span style="color:#f92672">=</span> lixin 
User_Alias TESTUSER <span style="color:#f92672">=</span> stu1, stu2
Cmnd_Alias NETWORK <span style="color:#f92672">=</span> /bin/rm
TESTUSER     LOCALHOST<span style="color:#f92672">=(</span>root<span style="color:#f92672">)</span> NOPASSWD: NETWORK  <span style="color:#75715e">#不需要输入密码</span>

<span style="color:#75715e">##查看用户的sudo权限</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># su - stu1</span>
<span style="color:#f92672">[</span>stu1@lixin ~<span style="color:#f92672">]</span>$ sudo -l
Matching Defaults entries <span style="color:#66d9ef">for</span> stu1 on this host:
……
LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE<span style="color:#ae81ff">\&#34;</span>, env_keep<span style="color:#f92672">+=</span><span style="color:#ae81ff">\&#34;</span>LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY<span style="color:#ae81ff">\&#34;</span>,
secure_path<span style="color:#f92672">=</span>/sbin<span style="color:#ae81ff">\:</span>/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin

User stu1 may run the following commands on this host:
<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> NOPASSWD: /bin/rm  <span style="color:#75715e">#stu1已经具有/bin/rm权限，并且没有输入密码</span>
<span style="color:#f92672">[</span>stu1@lixin ~<span style="color:#f92672">]</span>$
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># su - stu2</span>
<span style="color:#f92672">[</span>stu2@lixin ~<span style="color:#f92672">]</span>$ sudo -l
Matching Defaults entries <span style="color:#66d9ef">for</span> stu2 on this host:
……
LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE<span style="color:#ae81ff">\&#34;</span>, env_keep<span style="color:#f92672">+=</span><span style="color:#ae81ff">\&#34;</span>LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY<span style="color:#ae81ff">\&#34;</span>,
secure_path<span style="color:#f92672">=</span>/sbin<span style="color:#ae81ff">\:</span>/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin

User stu2 may run the following commands on this host:
<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> NOPASSWD: /bin/rm  <span style="color:#75715e">#stu2已经具有/bin/rm权限，并且没有输入密码</span>
<span style="color:#f92672">[</span>stu2@lixin ~<span style="color:#f92672">]</span>$
</code></pre></div><p>小结: </p>
<table>
<thead>
<tr>
<th style="text-align:center">用户</th>
<th style="text-align:center">主机</th>
<th style="text-align:center">角色</th>
<th style="text-align:center">命令</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">TESTUSER</td>
<td style="text-align:center">LOCALHOST</td>
<td style="text-align:center">root</td>
<td style="text-align:center">NOPASSWD</td>
</tr>
<tr>
<td style="text-align:center">stu1,stu2</td>
<td style="text-align:center">lixin</td>
<td style="text-align:center"></td>
<td style="text-align:center">/bin/rm</td>
</tr>
</tbody>
</table>
<h2 id="55注意事项">5.5注意事项</h2>
<ul>
<li>授权规则中的所有ALL字符串必须为大写字母。</li>
<li>允许执行的命令是有顺序的。命令的顺序是从后向前的，编写的时候要把禁止的命令放在允许的命令的后面。</li>
<li>一行内容超长可以用“\”斜线表示换行。</li>
<li>&lsquo;！&lsquo;叹号表示非，就是命令取反的意思，既禁止使用的命令。（例如/bin/*, ！/bin/rm 允许使用/bin下所有命令，但不允许使用rm命令）</li>
</ul>
<h2 id="56远程执行sudo命令">5.6远程执行sudo命令</h2>
<p>默认情况下我们是无法通过ssh远程执行sudo命令的</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># ssh stu1@10.0.0.8 sudo rm -rf /home/home      </span>
stu1@10.0.0.8<span style="color:#ae81ff">\&#39;</span>s password: 
sudo: sorry, you must have a tty to run sudo   <span style="color:#75715e">#由于sudo是交互式的输入密码执行，提示需[root@lixin home]#                         要一个tty（虚拟终端）来执行sudo</span>
</code></pre></div><p>查看visudo配置文件后发现如下内容：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Disable &#34;ssh hostname sudo &lt;cmd&gt;&#34;, because it will show the password in clear. </span>
<span style="color:#75715e">#         You have to run &#34;ssh -t hostname sudo &lt;cmd&gt;&#34;.</span>
<span style="color:#75715e">#</span>
Defaults    requiretty    <span style="color:#75715e">#原来是sudoers禁止了ssh hostname sudo&lt;cmd&gt;这种方式，因为可能会泄露密码，但它提示我们可以使用ssh –t hostname sudo &lt;cmd&gt;来执行</span>
</code></pre></div><p>查看了ssh 的-t参数，表示指定一个伪终端来迫使shell以交互的模式来工作。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># ssh -t stu1@10.0.0.8 sudo rm -rf /home/home</span>
stu1@10.0.0.8<span style="color:#ae81ff">\&#39;</span>s password: 
Connection to 10.0.0.8 closed.
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># ls –l      #删除成功</span>
</code></pre></div><h2 id="57sudo审计功能">5.7sudo审计功能</h2>
<p>通过配置<code>sudo</code>的审计功能，来查看用户使用<code>sudo</code>权限都进行了哪些操作<br>
配置日志审计功能：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 1.确认sudo 和rsyslog这两个包是否存在</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># rpm -qa sudo rsyslog</span>
rsyslog-5.8.10-10.el6_6.x86_64
sudo-1.8.6p3-19.el6.x86_64
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
<span style="color:#75715e"># 2.配置/etc/sudoers</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># echo &#34;Defaults     logfile=/var/log/sudo.log&#34; &gt;&gt;/etc/sudoers</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># tail -1 /etc/sudoers</span>
Defaults     logfile<span style="color:#f92672">=</span>/var/log/sudo.log
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
<span style="color:#75715e">## 在配置文件中添加sudo日记记录（Defaults loginfile=/var/log/sudo.log）</span>
<span style="color:#75715e"># 3.测试是否记录</span>
<span style="color:#75715e">##使用stu1用户执行sudo权限</span>
<span style="color:#f92672">[</span>stu1@lixin home<span style="color:#f92672">]</span>$ rm -rf stu10
rm: cannot remove <span style="color:#e6db74">&#39;stu10&#39;</span>: Permission denied
<span style="color:#f92672">[</span>stu1@lixin home<span style="color:#f92672">]</span>$ sudo rm -rf stu10
<span style="color:#f92672">[</span>stu1@lixin home<span style="color:#f92672">]</span>$ ls -l
<span style="color:#f92672">[</span>stu1@lixin home<span style="color:#f92672">]</span>$

<span style="color:#75715e">##查看sudo日志信息，确认是否记录</span>
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e"># cat /var/log/sudo.log </span>
Apr  <span style="color:#ae81ff">2</span> 23:44:55 : stu1 : TTY<span style="color:#f92672">=</span>pts/0 ; PWD<span style="color:#f92672">=</span>/home/stu1 ; USER<span style="color:#f92672">=</span>root ;
COMMAND<span style="color:#f92672">=</span>/bin/rm -rf test.txt
Apr  <span style="color:#ae81ff">2</span> 23:45:15 : stu1 : TTY<span style="color:#f92672">=</span>pts/0 ; PWD<span style="color:#f92672">=</span>/home ; USER<span style="color:#f92672">=</span>root ; COMMAND<span style="color:#f92672">=</span>/bin/rm -rf
stu10
<span style="color:#f92672">[</span>root@lixin home<span style="color:#f92672">]</span><span style="color:#75715e">#  #已成功记录sudo日志</span>
</code></pre></div><p>{% endraw %}</p>

</div>


  
</article>
      <footer id="main-footer" class="container main_footer">
  

  <div class="container nav foot no-print">
  
<a href="https://dachenzi.github.io/license">license</a>


  <a class="toplink" href="#">back to top</a>

</div>

  <div class="container credits">
  
<div class="container footline">
  
  code with <!-- raw HTML omitted --><!-- raw HTML omitted -->


</div>


  
<div class="container copyright">
  
  (c) 2015 Lee xin.


</div>


</div>

</footer>

    </main>
    
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;
    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//your_disqus_shortname.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



    
  </body>
</html>

