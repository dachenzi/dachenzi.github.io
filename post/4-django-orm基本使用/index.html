<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>4-django-orm基本使用 - daxin.li&#39;s blog</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="daxin.li" />
  <meta name="description" content="文章目录 1 数据库与ORM 2 orm的配置 2.1 引擎和配置 2.2 mysql驱动程序 3 orm 表模型 3.1 创建表对象 3.2 Django字段类型 3.3 常用字段参数说明 3.4 特殊类" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.75.1" />


<link rel="canonical" href="https://dachenzi.github.io/post/4-django-orm%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.b3a8813c06e6d785beba22bf8264e174fa2cb3a396b22f9ba24e2c00c18aaf7f.css" integrity="sha256-s6iBPAbm14W&#43;uiK/gmThdPoss6OWsi&#43;bok4sAMGKr38=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="4-django-orm基本使用" />
<meta property="og:description" content="文章目录 1 数据库与ORM 2 orm的配置 2.1 引擎和配置 2.2 mysql驱动程序 3 orm 表模型 3.1 创建表对象 3.2 Django字段类型 3.3 常用字段参数说明 3.4 特殊类" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dachenzi.github.io/post/4-django-orm%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" />
<meta property="article:published_time" content="2019-05-16T05:20:02+00:00" />
<meta property="article:modified_time" content="2019-05-16T05:20:02+00:00" />
<meta itemprop="name" content="4-django-orm基本使用">
<meta itemprop="description" content="文章目录 1 数据库与ORM 2 orm的配置 2.1 引擎和配置 2.2 mysql驱动程序 3 orm 表模型 3.1 创建表对象 3.2 Django字段类型 3.3 常用字段参数说明 3.4 特殊类">
<meta itemprop="datePublished" content="2019-05-16T05:20:02+00:00" />
<meta itemprop="dateModified" content="2019-05-16T05:20:02+00:00" />
<meta itemprop="wordCount" content="10218">



<meta itemprop="keywords" content="Django框架," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="4-django-orm基本使用"/>
<meta name="twitter:description" content="文章目录 1 数据库与ORM 2 orm的配置 2.1 引擎和配置 2.2 mysql驱动程序 3 orm 表模型 3.1 创建表对象 3.2 Django字段类型 3.3 常用字段参数说明 3.4 特殊类"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">daxin.li's blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://dachenzi.github.io/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://dachenzi.github.io/post/">文章</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://dachenzi.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://dachenzi.github.io/categories/">类别</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://gohugo.io" rel="noopener" target="_blank">
              关于
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      daxin.li's blog
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://dachenzi.github.io/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://dachenzi.github.io/post/">文章</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://dachenzi.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://dachenzi.github.io/categories/">类别</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://gohugo.io" rel="noopener" target="_blank">
              关于
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">4-django-orm基本使用</h1>
      
      <div class="post-meta">
        <time datetime="2019-05-16" class="post-time">
          2019-05-16
        </time>
        <div class="post-category">
            <a href="https://dachenzi.github.io/categories/django%E6%A1%86%E6%9E%B6/"> Django框架 </a>
            
          </div>
        <span class="more-meta"> 约 10218 字 </span>
          <span class="more-meta"> 预计阅读 21 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#21-引擎和配置">2.1 引擎和配置</a></li>
    <li><a href="#22-mysql驱动程序">2.2 mysql驱动程序</a></li>
  </ul>

  <ul>
    <li><a href="#31-创建表对象">3.1 创建表对象</a></li>
    <li><a href="#32-django字段类型">3.2 Django字段类型</a></li>
    <li><a href="#33-常用字段参数说明">3.3 常用字段参数说明</a></li>
    <li><a href="#34-特殊类型字段参数说明">3.4 特殊类型字段参数说明</a></li>
    <li><a href="#35-meta信息">3.5 Meta信息</a></li>
    <li><a href="#36-生成表">3.6 生成表</a>
      <ul>
        <li><a href="#361-注册app">3.6.1 注册app</a></li>
        <li><a href="#362-修改表结构遇到的问题">3.6.2 修改表结构遇到的问题</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#41-orm之增加">4.1 orm之增加</a></li>
    <li><a href="#42-orm之删除">4.2 orm之删除</a></li>
    <li><a href="#43-orm之修改">4.3 orm之修改</a></li>
    <li><a href="#44-orm之查询">4.4 orm之查询</a>
      <ul>
        <li><a href="#441-查询过滤方法">4.4.1 查询过滤方法</a></li>
        <li><a href="#442-限制查询集切片">4.4.2 限制查询集（切片）</a></li>
        <li><a href="#442-字段查询双下划线">4.4.2 字段查询（双下划线）</a></li>
        <li><a href="#443-q对象">4.4.3 Q对象</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#51-一对多">5.1 一对多</a>
      <ul>
        <li><a href="#511-正向查询双下划线">5.1.1 正向查询(双下划线)</a></li>
        <li><a href="#512-反向查询set">5.1.2 反向查询(set)</a></li>
      </ul>
    </li>
    <li><a href="#52-多对多">5.2 多对多</a>
      <ul>
        <li><a href="#521-手动创建">5.2.1 手动创建</a></li>
        <li><a href="#522-自动创建">5.2.2 自动创建</a></li>
        <li><a href="#523-操作关系表">5.2.3 操作关系表</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p><font size=5 face='微软雅黑'><strong>文章目录</strong></font></p>
<!-- TOC -->
<ul>
<li><a href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8Eorm">1 数据库与ORM</a></li>
<li><a href="#2-orm%E7%9A%84%E9%85%8D%E7%BD%AE">2 orm的配置</a>
<ul>
<li><a href="#21-%E5%BC%95%E6%93%8E%E5%92%8C%E9%85%8D%E7%BD%AE">2.1 引擎和配置</a></li>
<li><a href="#22-mysql%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F">2.2 mysql驱动程序</a></li>
</ul>
</li>
<li><a href="#3-orm-%E8%A1%A8%E6%A8%A1%E5%9E%8B">3 orm 表模型</a>
<ul>
<li><a href="#31-%E5%88%9B%E5%BB%BA%E8%A1%A8%E5%AF%B9%E8%B1%A1">3.1 创建表对象</a></li>
<li><a href="#32-django%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B">3.2 Django字段类型</a></li>
<li><a href="#33-%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E">3.3 常用字段参数说明</a></li>
<li><a href="#34-%E7%89%B9%E6%AE%8A%E7%B1%BB%E5%9E%8B%E5%AD%97%E6%AE%B5%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E">3.4 特殊类型字段参数说明</a></li>
<li><a href="#35-meta%E4%BF%A1%E6%81%AF">3.5 Meta信息</a></li>
<li><a href="#36-%E7%94%9F%E6%88%90%E8%A1%A8">3.6 生成表</a>
<ul>
<li><a href="#361-%E6%B3%A8%E5%86%8Capp">3.6.1 注册app</a></li>
<li><a href="#362-%E4%BF%AE%E6%94%B9%E8%A1%A8%E7%BB%93%E6%9E%84%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98">3.6.2 修改表结构遇到的问题</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#4-%E5%88%A9%E7%94%A8orm%E5%AE%8C%E6%88%90%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5">4 利用orm完成数据库的增删改查</a>
<ul>
<li><a href="#41-orm%E4%B9%8B%E5%A2%9E%E5%8A%A0">4.1 orm之增加</a></li>
<li><a href="#42-orm%E4%B9%8B%E5%88%A0%E9%99%A4">4.2 orm之删除</a></li>
<li><a href="#43-orm%E4%B9%8B%E4%BF%AE%E6%94%B9">4.3 orm之修改</a></li>
<li><a href="#44-orm%E4%B9%8B%E6%9F%A5%E8%AF%A2">4.4 orm之查询</a>
<ul>
<li><a href="#441-%E6%9F%A5%E8%AF%A2%E8%BF%87%E6%BB%A4%E6%96%B9%E6%B3%95">4.4.1 查询过滤方法</a></li>
<li><a href="#442-%E9%99%90%E5%88%B6%E6%9F%A5%E8%AF%A2%E9%9B%86%E5%88%87%E7%89%87">4.4.2 限制查询集（切片）</a></li>
<li><a href="#442-%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2%E5%8F%8C%E4%B8%8B%E5%88%92%E7%BA%BF">4.4.2 字段查询（双下划线）</a></li>
<li><a href="#443-q%E5%AF%B9%E8%B1%A1">4.4.3 Q对象</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#5-%E8%A1%A8%E4%B8%8E%E8%A1%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB">5 表与表之间的关系</a>
<ul>
<li><a href="#51-%E4%B8%80%E5%AF%B9%E5%A4%9A">5.1 一对多</a>
<ul>
<li><a href="#511-%E6%AD%A3%E5%90%91%E6%9F%A5%E8%AF%A2%E5%8F%8C%E4%B8%8B%E5%88%92%E7%BA%BF">5.1.1 正向查询(双下划线)</a></li>
<li><a href="#512-%E5%8F%8D%E5%90%91%E6%9F%A5%E8%AF%A2set">5.1.2 反向查询(set)</a></li>
</ul>
</li>
<li><a href="#52-%E5%A4%9A%E5%AF%B9%E5%A4%9A">5.2 多对多</a>
<ul>
<li><a href="#521-%E6%89%8B%E5%8A%A8%E5%88%9B%E5%BB%BA">5.2.1 手动创建</a></li>
<li><a href="#522-%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA">5.2.2 自动创建</a></li>
<li><a href="#523-%E6%93%8D%E4%BD%9C%E5%85%B3%E7%B3%BB%E8%A1%A8">5.2.3 操作关系表</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="1-数据库与orm">1 数据库与ORM</h1>
<p>对象关系映射（英语：(Object Relational Mapping，简称ORM，或O/RM，或O/R mapping），是一种程序技术，用于实现面向对象编程语言里不同类型系统的数据之间的转换 。从效果上说，它其实是创建了一个可在编程语言里使用的&ndash;“虚拟对象数据库”。</p>
<p>简单一句话来说：就是把数据库的表映射为一个个对象，对对象的操作会被映射成SQL语句，在数据库执行。<br>
<img src="../photo/django-orm.png" alt="django-orm"></p>
<h1 id="2-orm的配置">2 orm的配置</h1>
<p>django默认支持sqlite，mysql, oracle,postgresql数据库。</p>
<ul>
<li>sqllit: django默认使用sqlite的数据库，默认自带sqlite的数据库驱动 , 引擎名称：django.db.backends.sqlite3</li>
<li>mysql: 引擎名称：django.db.backends.mysql</li>
</ul>
<h2 id="21-引擎和配置">2.1 引擎和配置</h2>
<p>在django的项目中会默认使用sqlite数据库，在settings里有如下设置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="o">-</span> <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
<span class="o">-</span> <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;db.sqlite3&#39;</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>下面是MySQL的配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="o">-</span> <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span> 
<span class="o">-</span> <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;books&#39;</span><span class="p">,</span>    <span class="c1"># 你的数据库名称</span>
<span class="o">-</span> <span class="s1">&#39;USER&#39;</span><span class="p">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>     <span class="c1"># 你的数据库用户名</span>
<span class="o">-</span> <span class="s1">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>     <span class="c1"># 你的数据库密码</span>
<span class="o">-</span> <span class="s1">&#39;HOST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">-</span>  <span class="c1"># 你的数据库主机，留空默认为localhost</span>
<span class="o">-</span> <span class="s1">&#39;PORT&#39;</span><span class="p">:</span> <span class="s1">&#39;3306&#39;</span><span class="p">,</span>     <span class="c1"># 你的数据库端口</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>参数如下：</p>
<ul>
<li>NAME即数据库的名字，在mysql连接前该数据库必须已经创建，而上面的sqlite数据库下的db.sqlite3则是项目自动创建</li>
<li>USER和PASSWORD分别是数据库的用户名和密码。</li>
</ul>
<h2 id="22-mysql驱动程序">2.2 mysql驱动程序</h2>
<p>django可以使用如下mysql的驱动程序：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">MySQLdb</span><span class="err">（不完美支持</span><span class="n">Python3</span><span class="err">）</span> 
<span class="n">mysqlclient</span> <span class="p">(</span><span class="err">官方建议</span><span class="p">)</span>
<span class="n">PyMySQL</span><span class="p">(</span><span class="err">纯</span><span class="n">python的mysql驱动程序</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>建议使用：</p>
<ul>
<li>mysqlclient</li>
<li>PyMySQL</li>
</ul>
<p>django基础配置部分已经描述了mysqlclient的安装，这里介绍如何使用pymysql，首先需要安装</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pip</span> <span class="n">install</span> <span class="n">pymysql</span>
</code></pre></td></tr></table>
</div>
</div><p>下一步只需要找到项目名文件下的__init__,在里面写入：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pymysql</span>
<span class="n">pymysql</span><span class="o">.</span><span class="n">install_as_MySQLdb</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>即可完成配置</p>
<h1 id="3-orm-表模型">3 orm 表模型</h1>
<p>我们所说的ORM主要分为两种：</p>
<ul>
<li><code>DB First</code> 数据库里先创建数据库表结构，根据表结构生成类，根据类操作数据库</li>
<li><code>Code First</code> 先写代码，执行代码创建数据库表结构</li>
</ul>
<p>主流的orm都是code first。django 的orm也是code first，所以本质上分为两部分：</p>
<ul>
<li>根据类自动创建数据库表</li>
<li>根据类对数据库表中的数据进行各种操作</li>
</ul>
<h2 id="31-创建表对象">3.1 创建表对象</h2>
<p>现在有一张表，主要字段如下:<br>
<img src="../photo/orm-table.png" alt="orm-table"><br>
对应的models中的映射类为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>     <span class="c1"># 导入models,django提供的对象包含很多建表的方法</span>
 
<span class="c1"># Create your models here.</span>
 
<span class="k">class</span> <span class="nc">UserInfo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>    <span class="c1"># 需要继承models.Model</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s1">&#39;userinfo&#39;</span>  <span class="c1"># 在数据库中生成的表明</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;用户名&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span><span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;密码&#39;</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;邮箱&#39;</span><span class="p">)</span>
 
 
<span class="c1"># AutoField : 自增字段，类似于mysql的int字段加auto_increment属性</span>
<span class="c1"># CharField：可变长字段，类似于mysql的varchar类型，需要指定长度</span>
<span class="c1"># EmailField：邮件字段，仅仅提供给 django admin进行约束使用，映射到MySQL上，根本上也是字符串类型</span>
<span class="c1"># null：是否为空，通用参数，默认为否。</span>
<span class="c1"># verbose_name：django admin上对表操作时，显示的字段名称</span>
<span class="c1"># primary_key：主键</span>
<span class="c1"># max_length：针对于CharField字段，标示其长度</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="32-django字段类型">3.2 Django字段类型</h2>
<p>部分字段类型及说明如下：</p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>AutoField(Field)</td>
<td>int自增列，必须填入参数 primary_key=True</td>
</tr>
<tr>
<td>BigAutoField(AutoField)</td>
<td>bigint自增列，必须填入参数 primary_key=True<br>注：当model中如果没有自增列，则自动会创建一个列名为id的列</td>
</tr>
<tr>
<td>SmallIntegerField(IntegerField)</td>
<td>小整数 -32768 ～ 32767</td>
</tr>
<tr>
<td>PositiveSmallIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</td>
<td>正小整数 0 ～ 32767</td>
</tr>
<tr>
<td>IntegerField(Field)</td>
<td>整数列(有符号的) -2147483648 ～ 2147483647</td>
</tr>
<tr>
<td>PositiveIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</td>
<td>正整数 0 ～ 2147483647</td>
</tr>
<tr>
<td>BigIntegerField(IntegerField)</td>
<td>长整型(有符号的) -9223372036854775808 ～ 9223372036854775807</td>
</tr>
<tr>
<td>BooleanField(Field)</td>
<td>布尔值类型</td>
</tr>
<tr>
<td>NullBooleanField(Field)</td>
<td>可以为空的布尔值</td>
</tr>
<tr>
<td>CharField(Field)</td>
<td>字符类型,必须提供max_length参数， max_length表示字符长度</td>
</tr>
<tr>
<td>TextField(Field)</td>
<td>文本类型</td>
</tr>
<tr>
<td>EmailField(CharField)</td>
<td>字符串类型，Django Admin以及ModelForm中提供验证机制</td>
</tr>
<tr>
<td>IPAddressField(Field)</td>
<td>字符串类型，Django Admin以及ModelForm中提供验证 IPV4 机制</td>
</tr>
<tr>
<td>GenericIPAddressField(Field)</td>
<td>字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6</td>
</tr>
<tr>
<td>URLField(CharField)</td>
<td>字符串类型，Django Admin以及ModelForm中提供验证 URL</td>
</tr>
<tr>
<td>SlugField(CharField)</td>
<td>字符串类型，Django Admin以及ModelForm中提供验证支持 字母、数字、下划线、连接符（减号）</td>
</tr>
<tr>
<td>CommaSeparatedIntegerField(CharField)</td>
<td>字符串类型，格式必须为逗号分割的数字</td>
</tr>
<tr>
<td>UUIDField(Field)</td>
<td>字符串类型，Django Admin以及ModelForm中提供对UUID格式的验证</td>
</tr>
<tr>
<td>FilePathField(Field)</td>
<td>字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功</td>
</tr>
<tr>
<td>FileField(Field)</td>
<td>字符串，路径保存在数据库，文件上传到指定目录</td>
</tr>
<tr>
<td>ImageField(FileField)</td>
<td>字符串，路径保存在数据库，文件上传到指定目录</td>
</tr>
<tr>
<td>DateTimeField(DateField)</td>
<td>日期+时间格式 YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]</td>
</tr>
<tr>
<td>DateField(DateTimeCheckMixin, Field)</td>
<td>日期格式      YYYY-MM-DD</td>
</tr>
<tr>
<td>TimeField(DateTimeCheckMixin, Field)</td>
<td>时间格式      HH:MM[:ss[.uuuuuu]]</td>
</tr>
<tr>
<td>DurationField(Field)</td>
<td>长整数，时间间隔，数据库中按照bigint存储，ORM中获取的值为datetime.timedelta类型</td>
</tr>
<tr>
<td>FloatField(Field)</td>
<td>浮点型</td>
</tr>
<tr>
<td>DecimalField(Field)</td>
<td>10进制小数</td>
</tr>
<tr>
<td>BinaryField(Field)</td>
<td>二进制类型</td>
</tr>
</tbody>
</table>
<h2 id="33-常用字段参数说明">3.3 常用字段参数说明</h2>
<p>django中提供了很多参数对字段进行控制</p>
<p>通用类：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>null</td>
<td>是否可以为空</td>
</tr>
<tr>
<td>default</td>
<td>默认值</td>
</tr>
<tr>
<td>primary_key</td>
<td>主键</td>
</tr>
<tr>
<td>db_column</td>
<td>列名</td>
</tr>
<tr>
<td>db_index</td>
<td>索引(bool)</td>
</tr>
<tr>
<td>unique</td>
<td>唯一索引</td>
</tr>
</tbody>
</table>
<p>时间日期类：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>unique_for_date</td>
<td>对日期字段来说，表示只对时间做索引</td>
</tr>
<tr>
<td>unique_for_month</td>
<td>对日期字段来说，表示只对月份做索引</td>
</tr>
<tr>
<td>unique_for_year</td>
<td>对日期字段来说，表示只对年做索引</td>
</tr>
<tr>
<td>auto_now</td>
<td>无论是你添加还是修改对象，时间为你添加或者修改的时间。</td>
</tr>
<tr>
<td>auto_now_add</td>
<td>为添加时的时间，更新对象时不会有变动。</td>
</tr>
</tbody>
</table>
<p>django admin相关：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>choices</td>
<td>在django admin中显示下拉框，避免连表查询(比如用户类型，可以在存在内存中)</td>
</tr>
<tr>
<td>blank</td>
<td>在django admin中是否可以为空</td>
</tr>
<tr>
<td>verbose_name</td>
<td>字段在django admin中显示的名称</td>
</tr>
<tr>
<td>editable</td>
<td>在django admin中是否可以进行编辑，默认是true</td>
</tr>
<tr>
<td>error_message</td>
<td>当在django admin中输入的信息不匹配时，字段的提示信息</td>
</tr>
<tr>
<td>help_text</td>
<td>在django admin中输入框旁边进行提示</td>
</tr>
<tr>
<td>validators</td>
<td>在django admin中自定义规则限制</td>
</tr>
</tbody>
</table>
<p>django中提供了很多的字段类型，大部分都是提供给django admin 来做验证的，实际体现在数据库中的，大部分都是字符串类型。</p>
<h2 id="34-特殊类型字段参数说明">3.4 特殊类型字段参数说明</h2>
<p><code>GenericIPAddressField(Field)</code>：字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6<br>
参数：</p>
<ul>
<li>protocol，用于指定Ipv4或Ipv6， &lsquo;both&rsquo;,&ldquo;ipv4&rdquo;,&ldquo;ipv6&rdquo;</li>
<li>unpack_ipv4， 如果指定为True，则输入::ffff:192.0.2.1时候，可解析为192.0.2.1，开启刺功能，需要protocol=&ldquo;both&rdquo;</li>
</ul>
<p><code>FilePathField(Field)</code>:字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功能<br>
参数：</p>
<ul>
<li>path:文件夹路径</li>
<li>match=None:正则匹配</li>
<li>recursive=False:递归下面的文件夹</li>
<li>allow_files=True:允许文件</li>
<li>allow_folders=False:允许文件夹</li>
</ul>
<p><code>FileField(Field)</code>:字符串，路径保存在数据库，文件上传到指定目录<br>
参数：</p>
<ul>
<li>upload_to = &ldquo;&quot;:上传文件的保存路径</li>
<li>storage = None:存储组件，默认django.core.files.storage.FileSystemStorage</li>
</ul>
<p><code>ImageField(FileField)</code>:字符串，路径保存在数据库，文件上传到指定目录<br>
参数：</p>
<ul>
<li>upload_to = &quot;&rdquo;      上传文件的保存路径</li>
<li>storage = None      存储组件，默认django.core.files.storage.FileSystemStorage</li>
<li>width_field=None,   上传图片的高度保存的数据库字段名（字符串）</li>
<li>height_field=None   上传图片的宽度保存的数据库字段名（字符串）</li>
</ul>
<p><code>DecimalField(Field)</code>:10进制小数<br>
参数：</p>
<ul>
<li>max_digits，小数总长度</li>
<li>decimal_places，小数位长度</li>
</ul>
<h2 id="35-meta信息">3.5 Meta信息</h2>
<p>在类内部定义内部类Meta，由于设置映射的表的元数据信息，</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_name</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
    
    <span class="nb">id</span><span class="o">...</span>
    <span class="n">name</span><span class="o">...</span>
</code></pre></td></tr></table>
</div>
</div><p>这里的Meta的类属性db_name，表示生成的数据库表名称为&rsquo;user',更多的参数有：</p>
<table>
<thead>
<tr>
<th>属性信息</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>db_tablespace</td>
<td>有些数据库有数据库表空间，比如Oracle。你可以通过db_tablespace来指定这个模型对应的数据库表放在哪个数据库表空间。</td>
</tr>
<tr>
<td>managed</td>
<td>默认值为True,Django可以对数据库表进行 migrate或migrations、删除等操作，如果为False的时候，不会对数据库表进行创建、删除等操作。可以用于现有表、数据库视图等，其他操作是一样的。</td>
</tr>
<tr>
<td>ordering</td>
<td>告诉Django模型对象返回的记录结果集是按照哪个字段排序的</td>
</tr>
<tr>
<td>unique_together</td>
<td>设置两个字段保持唯一性时使用</td>
</tr>
<tr>
<td>verbose_name</td>
<td>给模型类起一个更可读的名字</td>
</tr>
<tr>
<td>verbose_name_plural</td>
<td>表在django admin中显示的名称</td>
</tr>
</tbody>
</table>
<blockquote>
<p>常用的就是db_table，用于指定生成的表的名称</p>
</blockquote>
<h2 id="36-生成表">3.6 生成表</h2>
<p>        前面我们已经编写了对应数据库表的类，这里我们将进行实例化(创建数据库对应的表)。利用django提供的命令进行数据库的初始化工作.(以及其他对数据库表进行修改的动作，比如修改表结构，字段属性等，都需要执行如下步骤)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 进入项目目录下执行</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">makemigrations</span>
<span class="c1"># 大致含义是：把类转换成对应格式的sql语句。</span>
 
<span class="c1"># 创建表</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span>
<span class="c1"># 在数据库中执行生成的sql语句</span>
</code></pre></td></tr></table>
</div>
</div><p>注意：</p>
<ul>
<li>执行makemigrations后生成的文件，存放在应用目录下的migrations目录下，一般以0001_initial.py为文件名并且依次递增。</li>
<li>0001_initial.py存放的是 django 根据我们写的 class 生成的相关代码，执行migrate后，会根据这些代码生成对应的数据库表。</li>
<li>如果我们执行migrate后没有生成我们创建的表格，那么需要确认在django配置文件中，是否加载了我们的应用(因为django会加载setting里面的install_app中查找对应的modules.py)</li>
<li>表名默认是：应用名_class类名,可以在映射类内部定义内部类Meta，设置db_table=&lsquo;表名&rsquo;，来修改在数据库中生存的表名</li>
</ul>
<h3 id="361-注册app">3.6.1 注册app</h3>
<p>如果没有生成对应的表文件，那么需要在settings.py中，注册你的app</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># settings.py</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;app01.apps.App01Config&#39;</span><span class="p">,</span>
    <span class="s1">&#39;你的app名称&#39;</span>       
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="362-修改表结构遇到的问题">3.6.2 修改表结构遇到的问题</h3>
<p>当我们对已生成的表添加新字段时，会出现如下情况</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">ou</span> <span class="n">are</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">add</span> <span class="n">a</span> <span class="n">non</span><span class="o">-</span><span class="n">nullable</span> <span class="n">field</span> <span class="s1">&#39;code&#39;</span> <span class="n">to</span> <span class="n">business</span> <span class="n">without</span> <span class="n">a</span> <span class="n">default</span><span class="p">;</span> <span class="n">we</span> <span class="n">can</span><span class="s1">&#39;t do that (the database needs something to populate existing rows).</span>
<span class="n">Please</span> <span class="n">select</span> <span class="n">a</span> <span class="n">fix</span><span class="p">:</span>
 <span class="mi">1</span><span class="p">)</span> <span class="n">Provide</span> <span class="n">a</span> <span class="n">one</span><span class="o">-</span><span class="n">off</span> <span class="n">default</span> <span class="n">now</span> <span class="p">(</span><span class="n">will</span> <span class="n">be</span> <span class="nb">set</span> <span class="n">on</span> <span class="nb">all</span> <span class="n">existing</span> <span class="n">rows</span> <span class="k">with</span> <span class="n">a</span> <span class="n">null</span> <span class="n">value</span> <span class="k">for</span> <span class="n">this</span> <span class="n">column</span><span class="p">)</span>
 <span class="mi">2</span><span class="p">)</span> <span class="n">Quit</span><span class="p">,</span> <span class="ow">and</span> <span class="n">let</span> <span class="n">me</span> <span class="n">add</span> <span class="n">a</span> <span class="n">default</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">py</span>
<span class="n">Select</span> <span class="n">an</span> <span class="n">option</span><span class="p">:</span>
</code></pre></td></tr></table>
</div>
</div><p>        由于我们添加字段会影响之前的数据，所以这时django提醒我们，不能只是单纯的添加一个字段，还需要为该字段指定对应的值，当然有几种解决办法：</p>
<ul>
<li>设置新增字段default属性，表示其默认值</li>
<li>设置新增字段null属性，表示其默认可以为空</li>
<li>根据上面的提示，选择1，手动输入默认值即可(注意默认值需要用引号引起来，不然django认为输入的数据是个变量)</li>
</ul>
<h1 id="4-利用orm完成数据库的增删改查">4 利用orm完成数据库的增删改查</h1>
<p>接下来就需要利用orm来对数据库的表数据进行增删改查等基本操作了。</p>
<h2 id="41-orm之增加">4.1 orm之增加</h2>
<p>        根据django的MTV架构，业务的处理是在views中完成的，那么对数据库的查询逻辑也应该在views中编写，而我们定义的数据库对象在model.py中，那么在导入之后，才能进行表操作。</p>
<p>django提供了两种增加数据的方式：1、create，2、save</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#------------------------------------- create -------------------------------------</span>
<span class="kn">from</span> <span class="nn">app01</span> <span class="kn">import</span> <span class="n">models</span>      <span class="c1"># 从自己的应用中导入models模块</span>
 
<span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;daxin&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;abc.123&#39;</span>
<span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;daixin@qq.com&#39;</span>
<span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span>
 
<span class="c1"># 表对象.objects.create() 用来新增数据</span>
<span class="c1"># name,password,email 表示表的字段</span>
<span class="c1"># 等号右边的表示数据</span>
<span class="c1"># 传递的key也可以是字典利用**dic进行传递，在后面利用form的时候会经常使用这种方式。</span>
<span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;usernane&#39;</span><span class="p">:</span><span class="s1">&#39;daxin&#39;</span><span class="p">,</span><span class="s1">&#39;password&#39;</span><span class="p">:</span><span class="s1">&#39;abc.123&#39;</span><span class="p">,</span><span class="n">email</span><span class="o">=</span><span class="s1">&#39;daxin@qq.com&#39;</span><span class="p">}</span>
<span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="nb">dict</span><span class="p">)</span>
 


<span class="c1">#------------------------------------- save -------------------------------------</span>
<span class="kn">from</span> <span class="nn">app01</span> <span class="kn">import</span> <span class="n">models</span>      <span class="c1"># 从自己的应用中导入models模块</span>
 
<span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;daxin&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;abc.123&#39;</span>
<span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;daixin@qq.com&#39;</span>
<span class="n">userobj</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span>
<span class="n">userobj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
 
<span class="c1"># save的方式是利用对象实例化的传递参数后，调用save方法进行保存的</span>
<span class="c1"># 利用对象，我们可以方便的进行数据修改后，再进行save</span>
<span class="c1"># 比如 userobj.name = &#39;dahuaidan&#39;</span>
<span class="c1"># userobj.save()</span>
</code></pre></td></tr></table>
</div>
</div><p>注意：利用create新增数据时，会默认返回新增加的数据对象，我们可以接受该对象来进行其他的操作，比如添加多对多关系等</p>
<blockquote>
<p>比较常用的方式是 利用create进行数据的增加</p>
</blockquote>
<h2 id="42-orm之删除">4.2 orm之删除</h2>
<p>想要对数据进行删除，首先需要匹配到数据，然后执行删除操作，那么就涉及两部分：查找，删除</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
 
<span class="c1"># 利用filter对数据唯一的字段进行过滤，匹配到删除的行，也可以用all()匹配所有数据，进行删除</span>
<span class="c1"># 利用delete方法进行删除操作</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="43-orm之修改">4.3 orm之修改</h2>
<p>整体思路和删除是相同的，首先查找到数据，然后对字段进行修改</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dachenzi&#39;</span><span class="p">)</span>
 
<span class="c1"># 利用filter过滤到要修改的数据，然后更新它的name字段的值</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="44-orm之查询">4.4 orm之查询</h2>
<p>查询会返回结果的集，它是django.db.models.query.QuerySet类型。是惰性求值，和sqlalchemy一样。结果就是查询的集。同时它也是一个可迭代对象。</p>
<ul>
<li>创建查询集不会带来任何数据库的访问，直到调用方法使用数据时，才会访问数据库。在迭代、序列化、if语句中
都会立即求值。</li>
<li>每一个查询集都包含一个缓存，来最小化对数据库的访问。</li>
</ul>
<h3 id="441-查询过滤方法">4.4.1 查询过滤方法</h3>
<p>返回结果集的方法：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>all()</td>
<td>获取所有</td>
</tr>
<tr>
<td>filter()</td>
<td>过滤，返回满足条件的数据</td>
</tr>
<tr>
<td>exclude()</td>
<td>排除，排除满足条件的数据</td>
</tr>
<tr>
<td>order_by()</td>
<td>以什么字段排序（在字段前面加<code>减号</code>，表示倒序）</td>
</tr>
<tr>
<td>values()</td>
<td>返回一个对象字典的列表，列表的元素是字典，字典内是字段和值的键值对</td>
</tr>
<tr>
<td>values_list()</td>
<td>返回一个对象字典的列表，列表的元素是元组，字典内是字段和值的键值对</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">models</span><span class="o">.</span><span class="n">Userinfo</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
<span class="c1"># 表示只取指定的id和username列</span>
 
<span class="c1"># 结果依旧返回的是QuerySet，但是数据不同，体现的形式是一个字典</span>
<span class="n">QuerySet</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;username&#39;</span><span class="p">:</span><span class="s1">&#39;daxin&#39;</span><span class="p">},{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;username&#39;</span><span class="p">:</span><span class="s1">&#39;dachenzi&#39;</span><span class="p">}</span><span class="o">......</span><span class="p">)</span>
 
<span class="c1"># 使用value_list(&#39;id&#39;,&#39;username&#39;)，体现的形式是一个元组</span>
<span class="n">QuerySet</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;daxin&#39;</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;dachenzi&#39;</span><span class="p">)</span><span class="o">......</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>关于filter：</p>
<ul>
<li>filter(k1=v1).filter(k2=v2) 等价于 filter(k1=v1, k2=v2)</li>
<li>filter(pk=10) 这里pk指的就是主键， 不用关心主键字段名，当然也可以使用使用主键名filter(std_id=10)</li>
</ul>
<blockquote>
<p>获取结果集的方法通过适当的组合可以链式编写。</p>
</blockquote>
<p>返回单个值的方法：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>get()</td>
<td>仅返回单个满足条件的对象<br>如果未能返回对象则抛出DoesNotExist异常；<br>如果能返回多条抛出MultipleObjectsReturned异常</td>
</tr>
<tr>
<td>count()</td>
<td>返回当前查询的总条数</td>
</tr>
<tr>
<td>first()</td>
<td>返回第一个对象</td>
</tr>
<tr>
<td>last()</td>
<td>返回最后一个对象</td>
</tr>
<tr>
<td>exist()</td>
<td>判断查询集中是否有数据，如果有则返回True</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 获取表里所有的对象</span>
<span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>    <span class="c1"># 结果为一个QuerySet对象(django提供的)，可以理解为一个列表</span>
 
<span class="c1"># 获取id为1的对象</span>
<span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># 类似于sql中的 where查询条件，结果也是一个QuerySet</span>
 
<span class="c1"># 获取name字段包含da的记录</span>
<span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__contains</span><span class="o">=</span><span class="s1">&#39;da&#39;</span><span class="p">)</span> <span class="c1"># 这里涉及了万能的双下划线，在后续会进行说明</span>
 
<span class="c1"># get获取一条数据</span>
<span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># 注意get不到数据，会直接抛出异常</span>
 
<span class="c1"># 除了id等于1的其他数据</span>
<span class="n">models</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>注意：</p>
<ul>
<li>查找到的不是想sql语句那样直接列出一行的各个字段及对应的值，而已把改行表示为一个行对象。匹配到一行，就表示1个表中的行对象。</li>
<li>每个对象内才包含了对应的字段和值。</li>
<li>通过 行对象.字段名，来获取对应的数据。</li>
<li>filter中包含多个条件，那么它们是and的关系。</li>
</ul>
<p>PS：由于filter、all取到的数据默认是 <code>QuerySet</code> 格式，在某些场景下我们只需要验证是否取到，我们可以直接获取结果中的第一个数据即可，即在最后添加.first()即可，表示取第一个数据，或者使用.count()来统计匹配到的数据的个数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">module</span><span class="o">.</span><span class="n">UserInfo</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;daxin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="442-限制查询集切片">4.4.2 限制查询集（切片）</h3>
<p>查询集对象可以直接使用索引下标的方式（不支持负索引），相当于SQL语句中的limit和offset子句。
注意使用索引返回的新的结果集，依然是惰性求值，不会立即查询。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">qs</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">20</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span>
<span class="c1"># LIMIT 20 OFFSET 20</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">20</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span>
<span class="c1"># LIMIT 10 OFFSET 20</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="442-字段查询双下划线">4.4.2 字段查询（双下划线）</h3>
<p>字段查询表达式可以作为filter()、exclude()、get()的参数，实现where子句。<br>
语法：<code>字段名称__比较运算符=值</code>,属性名和运算符之间使用<code>双下划线</code></p>
<p>比较运算符如下</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>举例</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>exact<br>filter(isdeleted=False)<br></td>
<td>filter(isdeleted__exact=False)</td>
<td>严格等于，可省略不写</td>
</tr>
<tr>
<td>contains</td>
<td>exclude(title__contains=&lsquo;天&rsquo;)</td>
<td>是否包含，大小写敏感，等价于like &lsquo;%天%&rsquo;</td>
</tr>
<tr>
<td>statswith<br>endswith</td>
<td>filter(title__startswith=&lsquo;天&rsquo;)</td>
<td>以什么开头或结尾，大小写敏感</td>
</tr>
<tr>
<td>isnull<br>isnotnull</td>
<td>filter(title__isnull=False)</td>
<td>是否为null</td>
</tr>
<tr>
<td>iexact<br>icontains<br>istartswith<br>iendswith<br></td>
<td></td>
<td>i的意思是忽略大小写</td>
</tr>
<tr>
<td>in</td>
<td>filter(pk__in=[1,2,3,100])</td>
<td>是否在指定范围数据中</td>
</tr>
<tr>
<td>gt、gte<br>lt、lte<br></td>
<td>filter(id__gt=3)<br>filter(pk__lte=6)<br>filter(pub_date__gt=date(2000,1,1))<br></td>
<td></td>
</tr>
<tr>
<td>year、month、day<br>week_day、hour<br>minute、second<br></td>
<td>filter(pub_date__year=2000)</td>
<td>对日期类型属性处理</td>
</tr>
</tbody>
</table>
<h3 id="443-q对象">4.4.3 Q对象</h3>
<p>        虽然Django提供传入条件的方式，但是不方便，它还提供了Q对象来解决。Q对象是django.db.models.Q，可以使用&amp;（and）、|（or）操作符来组成逻辑表达式。 ~ 表示not。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>
<span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">pk__lt</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>           <span class="c1"># 不如直接写User.objects.filter(pk&lt;6)</span>
<span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk__gt</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk_lt</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># 与</span>
<span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">pk_gt</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Q</span><span class="p">(</span><span class="n">pk_lt</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>   <span class="c1"># 与</span>
<span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>         <span class="c1"># 或</span>
<span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">~</span><span class="n">Q</span><span class="p">(</span><span class="n">pk__lt</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>               <span class="c1"># 非</span>
</code></pre></td></tr></table>
</div>
</div><p>可使用&amp;|和Q对象来构造复杂的逻辑表达式</p>
<ul>
<li>过滤器函数可以使用一个或多个Q对象</li>
<li>如果混用关键字参数和Q对象，那么Q对象必须位于关键字参数的前面。所有参数都将and在一起</li>
</ul>
<h1 id="5-表与表之间的关系">5 表与表之间的关系</h1>
<p>我们常说的表与表之间的关系有：一对一、一对多、多对多，下面分别说明</p>
<h2 id="51-一对多">5.1 一对多</h2>
<p>        表示当前表的某个字段的值，来自于其他表，比如人员表和部门表，在人员表中利用一对多外键关系标明该员工属于哪个部门。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">user_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s1">&#39;表名&#39;</span><span class="p">,</span><span class="n">to_field</span><span class="o">=</span><span class="s1">&#39;字段&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;xxx&#39;</span><span class="p">,</span><span class="n">limit_choices_to</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xx&#39;</span><span class="p">:</span><span class="s1">&#39;xx&#39;</span><span class="p">})</span>       <span class="c1"># 默认会自动关联对方表的ID字段(主键)，手动指定的话必须是唯一列才行。</span>
</code></pre></td></tr></table>
</div>
</div><p>参数：</p>
<ol>
<li>limit_choices_to：django admin控制时，对选择的数据进行过滤，比如{&lsquo;gender&rsquo;:&lsquo;female&rsquo;},表示当关联表的gender字段的值为female，才会在django admin的管理页面中显示。</li>
<li>related_name: 在对表中插入的表示本表的对象(外键关联自己时，特别需要设置)</li>
</ol>
<p>注意：</p>
<ol>
<li>默认情况下，外键字段在数据库中存储的名称为：字段名_id (上面的例子的话，在数据库中的字段名：user_type_id)</li>
<li>外键字段(user_type_id)存放的是所关连表的id信息</li>
<li>同时还存在一个字段名(上面的例子就是user_type)对象，这个对象指代的就是所关联的表中的数据对象</li>
<li>我们可以通过user_type，来跨表获取其关联的信息的某写字段的值(通过.字段名，即可访问)</li>
</ol>
<h3 id="511-正向查询双下划线">5.1.1 正向查询(双下划线)</h3>
<p>        什么叫正向查询？还是拿人员表和部门表举例，外键关系存在人员表中，那么我们通过人员表利用表中的外键字段就可以查询到该人员的部门信息，我一般称之为正向查询。</p>
<p>一对多跨表查询例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># -------------------- models.py --------------------</span>

<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Business</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span><span class="o">=</span><span class="s1">&#39;business&#39;</span>
    <span class="n">caption</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;SA&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Host</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span><span class="o">=</span><span class="s1">&#39;host&#39;</span>
    <span class="n">nid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">hostname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GenericIPAddressField</span><span class="p">(</span><span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;ipv4&#39;</span><span class="p">,</span><span class="n">db_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s1">&#39;Business&#39;</span><span class="p">,</span><span class="n">to_field</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>    <span class="c1"># 外键关联Business表</span>

<span class="c1">#  -------------------- views.py --------------------</span>

<span class="k">def</span> <span class="nf">host</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Host</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s1">&#39;host.html&#39;</span><span class="p">,{</span><span class="s1">&#39;v1&#39;</span><span class="p">:</span><span class="n">v1</span><span class="p">})</span>

<span class="c1"># -------------------- host.html --------------------</span>

<span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&#34;en&#34;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&#34;UTF-8&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Title</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">主机信息</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">v1</span> <span class="o">%</span><span class="p">}</span>
            <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">row</span><span class="o">.</span><span class="n">nid</span> <span class="p">}}</span> <span class="o">-</span> <span class="p">{{</span> <span class="n">row</span><span class="o">.</span><span class="n">hostname</span> <span class="p">}}</span> <span class="o">-</span> <span class="p">{{</span> <span class="n">row</span><span class="o">.</span><span class="n">ip</span> <span class="p">}}</span> <span class="o">-</span> <span class="p">{{</span> <span class="n">row</span><span class="o">.</span><span class="n">port</span> <span class="p">}}</span> <span class="o">-</span> <span class="p">{{</span> <span class="n">row</span><span class="o">.</span><span class="n">b_id</span> <span class="p">}}</span> <span class="o">-</span> <span class="p">{{</span> <span class="n">row</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">caption</span> <span class="p">}}</span> <span class="o">-</span> <span class="p">{{</span> <span class="n">row</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">code</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>   <span class="c1"># 通过b对象，进行跨表查询主机业务线相关信息</span>
        <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>这里通过row.b_id 和通过b对象来获取 row.b.id 结果是相同的，区别在于使用b对象，会多一次sql查询</p>
</blockquote>
<p>PS：当多个表进行及联跨表，那么都可以通过表的外键字段使用点来进行跨表访问(或者使用双下划线)
双下划线和点跨表的不同之处在于：</p>
<ul>
<li>双下划线一般用于条件查询(values,values_list)</li>
<li>点则一般用于在结果中利用外键对象进行跨表查询</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># -------------- 利用点进行跨表查询 --------------</span>
 
<span class="c1"># 如果我只想获取主机地址和所属业务线使用点跨表的话</span>
<span class="n">v2</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Host</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s1">&#39;host.html&#39;</span><span class="p">,{</span><span class="s1">&#39;v2&#39;</span><span class="p">:</span><span class="n">v2</span><span class="p">})</span>
<span class="c1"># 前端代码</span>
<span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">v2</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">row</span><span class="o">.</span><span class="n">hostname</span> <span class="p">}}</span> <span class="o">-</span> <span class="p">{{</span> <span class="n">row</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">caption</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
<span class="c1"># 我们只用了两个字段，却取出了相关的所有数据。</span>
 
<span class="c1"># 是否可以在查询阶段只取出所需字段即可？使用双下划线__即可</span>
 
 
<span class="c1"># -------------- 利用双下划线跨表查询 --------------</span>
 
<span class="n">v3</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Host</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span><span class="s1">&#39;b__caption&#39;</span><span class="p">)</span>
<span class="c1"># 我们可以看到在作为value的条件语句，通过b对象配合双下划线就进行了一次跨表查询</span>
 
<span class="c1"># 前端代码</span>
<span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">%</span>  <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">v2</span> <span class="o">%</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">row</span><span class="o">.</span><span class="n">hostname</span> <span class="p">}}</span> <span class="o">-</span> <span class="p">{{</span> <span class="n">row</span><span class="o">.</span><span class="n">b__caption</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>    <span class="c1"># 只需要向字典一样即可。</span>
    <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span>  <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>在django内部，它之所以能识别__,是因为，它在处理values条件时，会使用__作为分隔符，分隔后再进行相关处理</p>
</blockquote>
<h3 id="512-反向查询set">5.1.2 反向查询(set)</h3>
<p>        很多时候我们会有另一种需求，查询一个部门下的所有员工，这时部门表中没有外间字段关联人员表啊，该怎么查？其实是可以的，我把这个查询方式称之为反向查询。<br>
        在建立外键关系时，不仅会在外键所在表中产生外键所关联表的对象，在所关联表中也会产生一个关联表的对象(可能有点绕，没找到更好的表达方式)，这个对象一般有两种体现方式：</p>
<ol>
<li>关联我的表(小写)：<code>一般用在values，values_list当作条件做字段过滤</code></li>
<li>关联我的表名(小写)_set：<code>一般当作对象，当作字段处理</code></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">departments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Department</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;user__name&#39;</span><span class="p">)</span>   <span class="c1"># 跨到管理本表的user表中，查找对应的user的名称，利用的是join 格式</span>
    <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">departments</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span>

        <span class="c1"># {&#39;user__name&#39;: &#39;daxin&#39;}</span>
        <span class="c1"># {&#39;user__name&#39;: &#39;dachenzi&#39;}</span>
        <span class="c1"># {&#39;user__name&#39;: &#39;hello&#39;}</span>
        <span class="c1"># {&#39;user__name&#39;: &#39;xiaoming&#39;}</span>
        <span class="c1"># {&#39;user__name&#39;: &#39;xiaochen&#39;}</span>
        
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;ok&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>对应的sql语句为：</p>
<ul>
<li>SELECT&quot;user&quot;.&ldquo;name&quot;FROM&quot;department&quot;LEFTOUTERJOIN&quot;user&quot;ON(&ldquo;department&rdquo;.&ldquo;dept_id&rdquo; = &ldquo;user&rdquo;.&ldquo;dept_id&rdquo;);</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">departments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Department</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">departments</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">dep</span><span class="o">.</span><span class="n">user_set</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>  <span class="c1"># user_set指代的是关联的user表对象</span>
            <span class="k">print</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>

            <span class="c1"># {&#39;name&#39;: &#39;daxin&#39;}</span>
            <span class="c1"># {&#39;name&#39;: &#39;dachenzi&#39;}</span>
            <span class="c1"># {&#39;name&#39;: &#39;hello&#39;}</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;ok&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>对应的sql语句为：</p>
<ul>
<li>SELECT &ldquo;department&rdquo;.&ldquo;dept_id&rdquo;, &ldquo;department&rdquo;.&ldquo;dept_name&rdquo; FROM &ldquo;department&rdquo; WHERE &ldquo;department&rdquo;.&ldquo;dept_id&rdquo; = 1;</li>
<li>SELECT &ldquo;user&rdquo;.&ldquo;name&rdquo; FROM &ldquo;user&rdquo; WHERE &ldquo;user&rdquo;.&ldquo;dept_id&rdquo; = 1;</li>
</ul>
<h2 id="52-多对多">5.2 多对多</h2>
<p>        前面说了一对多的情况，这里还有一种情况叫多对对，比如一个主机可以关联多个业务线，不同的业务线可以关联多个主机，所以这里，业务线和主机的关系为多对多，在多对多的情况下，有需要一张额外的表来表示对应关系，这里有两种情况来创建这张关系表。</p>
<h3 id="521-手动创建">5.2.1 手动创建</h3>
<p>手动创建，故名思议，我们需要手动的创建一张关系表，然后创建两个ForeignKey字段(一对多)，关联两张表即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 业务线表</span>
<span class="k">class</span> <span class="nc">Business</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">caption</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;SA&#39;</span><span class="p">)</span>
 
<span class="c1"># 主机表</span>
<span class="k">class</span> <span class="nc">Host</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">nid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">hostname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GenericIPAddressField</span><span class="p">(</span><span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;ipv4&#39;</span><span class="p">,</span><span class="n">db_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
 
<span class="c1"># 多对多关系表</span>
<span class="k">class</span> <span class="nc">Application</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s1">&#39;Host&#39;</span><span class="p">,</span><span class="n">to_field</span><span class="o">=</span><span class="s1">&#39;nid&#39;</span><span class="p">)</span>          <span class="c1"># 关联主机id，字段名为h_id，同时存在对象h，存放对应的Host信息</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s1">&#39;Business&#39;</span><span class="p">,</span><span class="n">to_field</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>       <span class="c1"># 关联业务线id,字段名为b_id，同时存在对象b，存放对应的Business信息</span>
</code></pre></td></tr></table>
</div>
</div><p>PS：一共手动创建三张表，可以利用创建的Application关系表来直接操作多对多关系。</p>
<h3 id="522-自动创建">5.2.2 自动创建</h3>
<p>在Django中，还存在一种方式为自动创建， 通过django提供的ManyToMany关键字创建。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 业务线表</span>
<span class="k">class</span> <span class="nc">Business</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">caption</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;SA&#39;</span><span class="p">)</span>
 
<span class="c1"># 主机表</span>
<span class="k">class</span> <span class="nc">Host</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">nid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">hostname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GenericIPAddressField</span><span class="p">(</span><span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;ipv4&#39;</span><span class="p">,</span><span class="n">db_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">business</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s1">&#39;Business&#39;</span><span class="p">)</span>      <span class="c1"># 通过manytomany字段创建多对多关系</span>
</code></pre></td></tr></table>
</div>
</div><p>注意：</p>
<ol>
<li>虽然我们创建了两张表，但是由于我们使用了manytomany关键字创建多对对关系，django还会为我们创建一张表名为当前表名加当前字段名的表(上面的例子就是：app01_host_business)，当作关系表，不会产生business字段。</li>
<li>由于我们没有关系表这个class类对象，所以我们不能直接操作关系表，需要通过Host对象间接通过business字段来操作关系表。</li>
<li>虽然利用manytomany关键字，能帮我们创建关系表，节省了很多代码，但是自动生成的表中只会生成两个字段(两张表的主键id字段)，不能定制其他字段，相反手动生成的表可以定制，平时可以根据情况二者混用。</li>
</ol>
<h3 id="523-操作关系表">5.2.3 操作关系表</h3>
<p>手动创建关系表的情况下，由于含有第三张表对应的class，那么我们可以直接使用这个class对关系表进行操作，但是多对多的情况下没有关系表的class，所以我们需要通过其他办法来操作。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>add()</td>
<td>添加关系</td>
</tr>
<tr>
<td>remove()</td>
<td>删除关系</td>
</tr>
<tr>
<td>clear()</td>
<td>清除所有关系　　</td>
</tr>
<tr>
<td>all()</td>
<td>获取对应的所有关系对象(在查询时这里可以使用all,filter,get等，就像查找过滤其他数据一样)</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">models</span><span class="o">.</span><span class="n">Host</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">nid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">business</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>   <span class="c1"># 添加两条多对多关系 1(host) --&gt; 1(business)，1(host) --&gt; 2(business)</span>
<span class="n">models</span><span class="o">.</span><span class="n">Host</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">nid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">business</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 删除一条多对多关系 1 -x-&gt; 2</span>
<span class="n">models</span><span class="o">.</span><span class="n">Host</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">nid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">business</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>    <span class="c1"># 清除nid为1的所有的多对多关系</span>
</code></pre></td></tr></table>
</div>
</div><p>下面是一个小栗子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># models.py</span>
<span class="k">class</span> <span class="nc">Bussiness</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s1">&#39;bussiness&#39;</span>
    <span class="n">bus_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">bus_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Host</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s1">&#39;host&#39;</span>
    <span class="n">host_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">host_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">host_ip</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GenericIPAddressField</span><span class="p">(</span><span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
    <span class="n">bus</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Bussiness</span><span class="p">)</span>

<span class="c1"># views.py</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">hosts</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Host</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="n">hosts</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">bus</span> <span class="ow">in</span> <span class="n">host</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>   <span class="c1"># 通过bus对象获取它关联的所有bussiness实例记录</span>
            <span class="k">print</span><span class="p">(</span><span class="n">host</span><span class="o">.</span><span class="n">host_name</span><span class="p">,</span> <span class="n">host</span><span class="o">.</span><span class="n">host_ip</span><span class="p">,</span> <span class="n">bus</span><span class="o">.</span><span class="n">bus_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;ok&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"><a href="https://dachenzi.github.io/author/daxin.li/">daxin.li</a></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2019-05-16
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content">原创文章，如需转载请注明文章作者和出处。谢谢！</span>
  </p>
</div>


    
    
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/static/wechat-qr-code.jpg">
        <span>微信打赏</span>
      </label>
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/static/alipay-qr-code.jpg">
        <span>支付宝打赏</span>
      </label>
  </div>
</div>

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://dachenzi.github.io/tags/django%E6%A1%86%E6%9E%B6/">Django框架</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/38-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-socketserver/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">38-网络编程-socketserver</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/27-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E7%BA%A7-%E6%8F%8F%E8%BF%B0%E5%99%A8/">
            <span class="next-text nav-default">27-面向对象高级-描述器</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
  
  

  
  

  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "dachenzi/dachenzi.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:dahlhin.li@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/dachenzi" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://weibo.com/2401416804/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo" rel="me noopener" class="iconfont"
      title="weibo"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M385.714286 733.714286q12-19.428571 6.285714-39.428571t-25.714286-28.571429q-19.428571-8-41.714286-0.571429t-34.285714 26.285714q-12.571429 19.428571-7.428571 39.142857t24.571429 28.857143 42.571429 1.428571 35.714286-27.142857zm53.714286-69.142857q4.571429-7.428571 2-15.142857t-10-10.571429q-8-2.857143-16.285714 2.857143t-12.285714 10.571429q-9.714286 17.714286 7.428571 25.714286 8 2.857143 16.571429 2.857143t12.571429-10.571429zm99.428571 61.142857q-25.714286 58.285714-90.285714 85.714286t-128 6.857143q-61.142857-19.428571-84.285714-72.285714t3.714286-107.142857q26.857143-53.142857 86.571429-79.428571t120.285714-10.857143q63.428571 16.571429 90.571429 68.285714t1.428571 108.857143zm178.285714-91.428571q-5.142857-54.857143-50.857143-97.142857t-119.142857-62.285714-156.857143-12q-127.428571 13.142857-211.142857 80.857143t-75.714286 151.142857q5.142857 54.857143 50.857143 97.142857t119.142857 62.285714 156.857143 12q127.428571-13.142857 211.142857-80.857143t75.714286-151.142857zm176 2.285714q0 38.857143-21.142857 79.714286t-62.285714 78.285714-96.285714 67.142857-129.142857 47.428571-154.571429 17.714286-157.142857-19.142857-137.428571-53.142857-98-86.285714-37.142857-114q0-65.714286 39.714286-140t112.857143-147.428571q96.571429-96.571429 195.142857-134.857143t140.857143 4q37.142857 36.571429 11.428571 119.428571-2.285714 8-0.571429 11.428571t5.714286 4 8.285714 2.857143 7.714286-2l3.428571-1.142857q79.428571-33.714286 140.571429-33.714286t87.428571 34.857143q25.714286 36 0 101.714286-1.142857 7.428571-2.571429 11.428571t2.571429 7.142857 6.857143 4.285714 9.714286 3.428571q32.571429 10.285714 58.857143 26.857143t45.714286 46.571429 19.428571 66.571429zm-42.285714-356.571429q24 26.857143 31.142857 62t-3.714286 67.142857q-4.571429 13.142857-16.857143 19.428571t-25.428571 2.285714q-13.142857-4.571429-19.428571-16.857143t-2.285714-25.428571q11.428571-36-13.714286-63.428571t-61.142857-20q-13.714286 2.857143-25.714286-4.571429t-14.285714-21.142857q-2.857143-13.714286 4.571429-25.428571t21.142857-14.571429q34.285714-7.428571 68 3.142857t57.714286 37.428571zm103.428571-93.142857q49.714286 54.857143 64.285714 127.142857t-7.714286 138q-5.142857 15.428571-19.428571 22.857143t-29.714286 2.285714-22.857143-19.428571-2.857143-29.714286q16-46.857143 5.714286-98.285714t-45.714286-90.285714q-35.428571-39.428571-84.571429-54.571429t-98.857143-4.857143q-16 3.428571-29.714286-5.428571t-17.142857-24.857143 5.428571-29.428571 24.857143-16.857143q70.285714-14.857143 139.428571 6.571429t118.857143 76.857143z"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/da-chen-zi-67" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="https://dachenzi.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2016 -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        daxin.li
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>



  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>









  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
